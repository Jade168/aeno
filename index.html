<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>AENO æ˜Ÿçƒæ–‡æ˜</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #0b1020;
      overflow: hidden;
      font-family: Arial, "Microsoft JhengHei", "PingFang HK", sans-serif;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
      background: linear-gradient(#091224, #081018);
    }

    /* é ‚éƒ¨HUD */
    #hudTop {
      position: fixed;
      top: 6px;
      left: 6px;
      right: 6px;
      display: flex;
      gap: 6px;
      justify-content: space-between;
      z-index: 50;
      pointer-events: none;
    }
    .hudBox {
      pointer-events: auto;
      background: rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.15);
      color: #fff;
      padding: 8px 12px;
      border-radius: 12px;
      font-size: 12px;
      line-height: 1.3em;
      backdrop-filter: blur(8px);
      max-width: 48vw;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
    }
    .hudRow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    .pill {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      white-space: nowrap;
    }

    /* æ§åˆ¶ä¸­å¿ƒé¢æ¿ */
    #panel {
      position: fixed;
      right: 8px;
      bottom: 80px;
      width: min(340px, 85vw);
      max-height: 30vh;
      background: rgba(10,14,20,0.9);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 16px;
      color: #fff;
      z-index: 100;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      backdrop-filter: blur(12px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      touch-action: none;
    }
    #panelHeader {
      padding: 10px 12px;
      font-size: 13px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255,255,255,0.06);
      cursor: grab;
    }
    #panelHeader:active { cursor: grabbing; }
    #panelBody {
      padding: 10px 12px;
      overflow: auto;
      font-size: 12px;
    }
    .btnRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    button {
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.18);
      color: #fff;
      border-radius: 10px;
      padding: 7px 10px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }
    button:active { transform: scale(0.96); }
    button:hover { background: rgba(255,255,255,0.12); }
    #togglePanelBtn {
      position: fixed;
      right: 8px;
      bottom: 12px;
      z-index: 200;
      border-radius: 999px;
      padding: 12px 16px;
      font-size: 12px;
      font-weight: bold;
      background: rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.18);
      backdrop-filter: blur(10px);
      color: #fff;
    }

    /* å»ºç¯‰é¸å–® */
    #buildMenu {
      position: fixed;
      left: 50%;
      top: 55%;
      transform: translate(-50%, -50%);
      width: min(360px, 92vw);
      max-height: 55vh;
      background: rgba(0,0,0,0.85);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 16px;
      color: #fff;
      z-index: 300;
      display: none;
      overflow: hidden;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
      backdrop-filter: blur(12px);
    }
    #buildMenuHeader {
      padding: 12px;
      font-size: 14px;
      font-weight: bold;
      background: rgba(255,255,255,0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #buildMenuBody {
      padding: 12px;
      overflow: auto;
      font-size: 12px;
    }
    .buildItem {
      padding: 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      margin-bottom: 10px;
      background: rgba(255,255,255,0.04);
    }
    .buildItemTitle {
      font-size: 13px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .buildCost {
      opacity: 0.9;
      margin-bottom: 6px;
    }

    /* AIåŠ©æ‰‹å°è©±æ¡† */
    #assistantChat {
      position: fixed;
      left: 10px;
      bottom: 85px;
      width: min(320px, 80vw);
      max-height: 25vh;
      background: rgba(0,0,0,0.8);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 16px;
      color: #fff;
      z-index: 250;
      overflow: hidden;
      display: none;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
    }
    #assistantChatHeader {
      padding: 10px 12px;
      font-size: 13px;
      font-weight: bold;
      background: rgba(255,255,255,0.06);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #assistantChatBody {
      padding: 10px 12px;
      font-size: 12px;
      overflow: auto;
      max-height: 12vh;
    }
    #assistantChatInputRow {
      display: flex;
      gap: 8px;
      padding: 10px 12px;
      border-top: 1px solid rgba(255,255,255,0.12);
    }
    #assistantInput {
      flex: 1;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: #fff;
      padding: 8px 10px;
      font-size: 12px;
      outline: none;
    }

    /* æ˜Ÿçƒé¸æ“‡ */
    #planetSelect {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      padding: 20px;
      backdrop-filter: blur(15px);
      overflow-y: auto;
    }
    .planetCard {
      width: min(380px, 92vw);
      padding: 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      margin-bottom: 12px;
      transition: all 0.2s;
    }
    .planetCard:hover { transform: translateY(-2px); }
    .planetTitle {
      font-size: 15px;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .planetDesc {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    /* è¨»å†Š+ç™»å…¥ç³»çµ± */
    #authOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      padding: 20px;
    }
    .authBox {
      width: min(360px, 90vw);
      background: rgba(20,25,40,0.9);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    }
    .authBox h2 {
      text-align: center;
      margin-bottom: 24px;
      font-size: 20px;
      color: #4a6cf7;
    }
    .authTab {
      display: flex;
      gap: 2px;
      margin-bottom: 20px;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
    }
    .authTabBtn {
      flex: 1;
      padding: 10px;
      border: none;
      background: transparent;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      border-radius: 0;
    }
    .authTabBtn.active {
      background: #4a6cf7;
      font-weight: bold;
    }
    .authForm {
      display: none;
      flex-direction: column;
      gap: 14px;
    }
    .authForm.active {
      display: flex;
    }
    .authForm input {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(0,0,0,0.4);
      color: #fff;
      font-size: 14px;
    }
    .authForm button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      background: #4a6cf7;
      color: #fff;
      border: none;
      font-size: 15px;
      font-weight: bold;
      margin-top: 8px;
    }
    .devNote {
      text-align: center;
      margin-top: 20px;
      font-size: 11px;
      opacity: 0.7;
    }
    .authTip {
      font-size: 11px;
      opacity: 0.8;
      text-align: center;
    }
    /* é–‹ç™¼è€…å°ˆå±¬å®‰å…¨ç¢¼è¼¸å…¥æ¡†ï¼ˆé»˜èªéš±è—ï¼‰ */
    #devKeyInput {
      display: none;
    }

    /* é€šç”¨æ¨£å¼ */
    .muted { opacity: 0.85; font-size: 11px; }
    .danger { color: #ff9aa2; }
    .ok { color: #a8ffb8; }
    .warning { color: #ffd966; }
  </style>
</head>

<body>
<!-- è¨»å†Š+ç™»å…¥ç•Œé¢ -->
<div id="authOverlay">
  <div class="authBox">
    <h2>ğŸ” AENO æ˜Ÿçƒæ–‡æ˜</h2>
    <div class="authTab">
      <button class="authTabBtn active" data-tab="register">é¦–æ¬¡è¨»å†Š</button>
      <button class="authTabBtn" data-tab="login">å·²æœ‰å¸³è™Ÿç™»å…¥</button>
    </div>

    <div class="authForm active" id="registerForm">
      <input type="text" id="registerID" placeholder="è«‹è¨­å®šä½ çš„å¸³è™ŸID" autocomplete="off">
      <!-- é–‹ç™¼è€…å°ˆå±¬å®‰å…¨ç¢¼è¼¸å…¥æ¡†ï¼Œåªæœ‰è¼¸å…¥ã€Œé˜¿å‹’é “ã€å…ˆæœƒé¡¯ç¤º -->
      <input type="password" id="devKeyInput" placeholder="è«‹è¼¸å…¥é–‹ç™¼è€…å°ˆå±¬å®‰å…¨ç¢¼" autocomplete="off">
      <input type="password" id="registerPwd" placeholder="è«‹è¨­å®šå¯†ç¢¼" autocomplete="new-password">
      <input type="password" id="registerPwdConfirm" placeholder="è«‹å†æ¬¡ç¢ºèªå¯†ç¢¼" autocomplete="new-password">
      <button id="registerBtn">å®Œæˆè¨»å†Š</button>
      <div class="authTip">æ¯å€‹å¸³è™ŸIDå”¯ä¸€ï¼Œè¨»å†Šå¾Œä¸å¯ä¿®æ”¹ï¼Œè«‹å¦¥å–„ä¿ç®¡å¯†ç¢¼</div>
    </div>

    <div class="authForm" id="loginForm">
      <input type="text" id="loginID" placeholder="è«‹è¼¸å…¥ä½ çš„å¸³è™ŸID" autocomplete="off">
      <input type="password" id="loginPwd" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" autocomplete="current-password">
      <button id="loginBtn">ç™»å…¥éŠæˆ²</button>
      <div class="authTip">æœªè¨»å†Šè«‹å…ˆé»æ“Šã€Œé¦–æ¬¡è¨»å†Šã€</div>
    </div>

    <div class="devNote">é–‹ç™¼è€…ï¼šé˜¿å‹’é “ | æœªä¾†å°‡é–‹æ”¾æŒ‡ç´‹èªè­‰</div>
  </div>
</div>

<canvas id="game"></canvas>

<div id="hudTop">
  <div class="hudBox" id="hudLeft">
    <div class="hudRow">
      <span class="pill">ğŸŒ <span id="planetName">?</span></span>
      <span class="pill">â±ï¸ <span id="gameYear">0</span> å¹´</span>
      <span class="pill">ğŸ‘¥ <span id="popCount">0</span></span>
    </div>
    <div class="hudRow" style="margin-top:4px;">
      <span class="pill">ğŸª™ é‡‘å¹£: <span id="coins">0</span></span>
      <span class="pill">ğŸŸ¡ AENO: <span id="aeno">0.0000</span></span>
    </div>
  </div>
  <div class="hudBox" id="hudRight">
    <div class="hudRow">
      <span class="pill">ğŸªµ æœ¨: <span id="wood">0</span></span>
      <span class="pill">ğŸª¨ çŸ³: <span id="stone">0</span></span>
      <span class="pill">â›ï¸ éµ: <span id="iron">0</span></span>
      <span class="pill">ğŸŒ¾ ç³§: <span id="food">0</span></span>
    </div>
    <div class="hudRow" style="margin-top:4px;">
      <span class="pill">âš™ï¸ å·¥å» : <span id="factoryCount">0</span></span>
      <span class="pill">ğŸ¤– æ©Ÿå™¨äºº: <span id="robotCount">0</span></span>
    </div>
  </div>
</div>

<button id="togglePanelBtn">ğŸ“Œ æ§åˆ¶ä¸­å¿ƒ</button>

<div id="panel">
  <div id="panelHeader">
    <span>ğŸ“Œ æ§åˆ¶ä¸­å¿ƒ</span>
    <span>
      <button id="btnSave">ä¿å­˜</button>
      <button id="btnHidePanel">æ”¶èµ·</button>
    </span>
  </div>
  <div id="panelBody">
    <div><b>æç¤ºï¼š</b>é»é ˜åœŸç©ºåœ°å¯ä»¥å»ºç¯‰æˆ¿å±‹</div>
    <div class="muted">Zoom: é›™æŒ‡ç¸®æ”¾ / æ»¾è¼ª | æ‹–åœ°åœ–ï¼šä¸€æŒ‡æ‹–å‹•</div>

    <div class="btnRow">
      <button id="btnBuildMode" class="active">ğŸ—ï¸ å»ºç¯‰æ¨¡å¼</button>
      <button id="btnUpgradeMode">â¬†ï¸ å‡ç´šæ¨¡å¼</button>
      <button id="btnAuto">ğŸ¤– è‡ªå‹•å»ºé€ : <span id="autoState">ON</span></button>
    </div>

    <div class="btnRow">
      <button id="btnAdSong">ğŸµ æ’­æ”¾å»£å‘Šæ­Œ</button>
      <button id="btnLoopSong">ğŸ” Loop: <span id="loopState">ON</span></button>
    </div>

    <div class="btnRow">
      <button id="btnRobotSend">ğŸš€ æ´¾æ©Ÿå™¨äººæ¢ç´¢</button>
      <button id="btnExchange">ğŸ¦ äº¤æ˜“æ‰€</button>
      <button id="btnTech">ğŸ§¬ ç§‘æŠ€æ¨¹</button>
    </div>

    <div style="margin-top:12px;">
      <b>AIåŠ©æ‰‹å„ªå…ˆé †åºï¼š</b>
      <div class="btnRow">
        <button class="prioBtn" data-prio="house">ğŸ  æˆ¿å±‹</button>
        <button class="prioBtn" data-prio="lumber">ğŸªµ ä¼æœ¨</button>
        <button class="prioBtn" data-prio="quarry">ğŸª¨ æ¡çŸ³</button>
        <button class="prioBtn" data-prio="mine">â›ï¸ ç¤¦å ´</button>
        <button class="prioBtn" data-prio="farm">ğŸŒ¾ è¾²ç”°</button>
      </div>
      <div class="muted">AIæœƒåš´æ ¼éµå®ˆå„ªå…ˆç´šï¼Œè‡ªå‹•å¹³è¡¡è³‡æº</div>
    </div>

    <div style="margin-top:12px;">
      <b>ç³»çµ±è¨Šæ¯ï¼š</b>
      <div id="logBox" style="margin-top:6px; max-height: 10vh; overflow:auto; font-size: 11px; opacity:0.92;"></div>
    </div>
  </div>
</div>

<div id="buildMenu">
  <div id="buildMenuHeader">
    <span>ğŸ—ï¸ å»ºç¯‰é¸å–®</span>
    <button id="closeBuildMenu">é—œé–‰</button>
  </div>
  <div id="buildMenuBody"></div>
</div>

<div id="assistantChat">
  <div id="assistantChatHeader">
    <span>ğŸ§¬ AENO AI åŠ©æ‰‹</span>
    <button id="closeChat">æ”¶èµ·</button>
  </div>
  <div id="assistantChatBody"></div>
  <div id="assistantChatInputRow">
    <input id="assistantInput" placeholder="è¼¸å…¥æŒ‡ä»¤ï¼šå·¡é‚ / æ”¶é›† / å»ºé€  / ä¿®å¾©..." />
    <button id="sendAssistant">é€å‡º</button>
  </div>
</div>

<div id="planetSelect">
  <div style="font-size:20px; font-weight:bold; margin-bottom:15px;">ğŸŒŒ é¸æ“‡ä½ çš„æ˜Ÿçƒ</div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŸ© Planet-01 ç¶ åŸæ˜Ÿ</div>
    <div class="planetDesc">æ£®æ—èŒ‚å¯†ï¼Œæœ¨æç”¢å‡ºé«˜ï¼Œé©åˆæ–°æ‰‹å…¥é–€</div>
    <button class="planetBtn" data-planet="Planet-01" data-seed="forest">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŸ« Planet-02 å²©çŸ³æ˜Ÿ</div>
    <div class="planetDesc">çŸ³ç¤¦è±å¯Œï¼Œå»ºç¯‰å‡ç´šæ›´å¿«ï¼Œåœ°å½¢å´å¶‡</div>
    <button class="planetBtn" data-planet="Planet-02" data-seed="rock">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">âš™ï¸ Planet-03 å·¥æ¥­æ˜Ÿ</div>
    <div class="planetDesc">éµç¤¦å„²é‡é«˜ï¼Œé©åˆç™¼å±•å·¥å» èˆ‡æ©Ÿå™¨äººæ–‡æ˜</div>
    <button class="planetBtn" data-planet="Planet-03" data-seed="iron">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¾ Planet-04 è¾²ç‰§æ˜Ÿ</div>
    <div class="planetDesc">åœŸåœ°è‚¥æ²ƒï¼Œç³§é£Ÿç”¢å‡ºé«˜ï¼Œäººå£æˆé•·é€Ÿåº¦å¿«</div>
    <button class="planetBtn" data-planet="Planet-04" data-seed="farm">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <!-- é–‹ç™¼è€…å°ˆå±¬é»‘æ´å­¤å³¶ï¼Œåªæœ‰é˜¿å‹’é “å¸³è™Ÿå…ˆæœƒé¡¯ç¤º -->
  <div class="planetCard" id="devBlackHoleCard" style="border-color: rgba(255,255,255,0.3); background: rgba(80,0,120,0.22); display:none;">
    <div class="planetTitle">ğŸ•³ï¸ é»‘æ´å­¤å³¶ï¼ˆé–‹ç™¼è€…å°ˆå±¬ï¼‰</div>
    <div class="planetDesc">ç‰¹æ®Šæ˜ŸåŸŸï¼Œå…¨æ˜Ÿçƒæ•¸æ“šç®¡ç†ã€ç§»æ°‘ç³»çµ±ã€ç”³è«‹åˆ¶åº¦ç”±æ­¤é–‹æ”¾</div>
    <button class="planetBtn" data-planet="BlackHole-Island" data-seed="blackhole">é€²å…¥é–‹ç™¼è€…å¾Œå°</button>
  </div>

  <div class="muted" style="margin-top:15px; text-align:center;">
    âš ï¸ éŠæˆ²æœƒè‡ªå‹•ä¿å­˜ï¼Œæ›´æ–°ç‰ˆæœ¬å¾Œä»å¯ä¿ç•™é€²åº¦<br/>
    éŸ³æ¨‚éœ€æ‰‹å‹•é»æ“Šæ’­æ”¾ï¼ˆæ‰‹æ©Ÿç€è¦½å™¨é™åˆ¶ï¼‰
  </div>
</div>

<!-- å¸³è™Ÿç³»çµ±æ ¸å¿ƒJSï¼ˆæœ€çµ‚å®‰å…¨ç‰ˆï¼‰ -->
<script>
const ACCOUNT_DB_KEY = "AENO_ACCOUNT_DATABASE";
const CURRENT_ACCOUNT_KEY = "AENO_CURRENT_LOGIN_ACCOUNT";
// ==================== æ ¸å¿ƒå®‰å…¨é…ç½®ï¼ˆåŠ å¯†å¾Œçš„å€¼ï¼Œå°±ç®—å…¬é–‹éƒ½å””æœƒæ³„éœ²ï¼‰ ====================
// åŸå§‹å®‰å…¨ç¢¼ï¼šé˜¿å‹’é “_AENO_#8899ï¼ˆåªæœ‰ä½ çŸ¥é“ï¼Œäººå“‹ç‡ä»£ç¢¼éƒ½é€†å‘å””å‡ºï¼‰
const DEV_ACCOUNT_ID = "é˜¿å‹’é “";
const DEV_KEY_HASH = "WlVOel9BRU5PX18jODg5OQ=="; // åŠ å¯†å¾Œçš„å®‰å…¨ç¢¼å“ˆå¸Œå€¼
// ==========================================================================================
const MS_PER_DAY = 86400000;
const GAME_SPEED_YEAR_PER_REALDAY = 10;

let currentPlayer = null;
let isLoggedIn = false;
let isDeveloper = false;
let state = { population: 0, robots: 0, buildings: [], isPlayingSong: false };

// å¸³è™Ÿç³»çµ±æ ¸å¿ƒå‡½æ•¸
function getAccountDB() {
  const raw = localStorage.getItem(ACCOUNT_DB_KEY);
  const db = raw ? JSON.parse(raw) : {};
  // è‡ªå‹•å…¼å®¹èˆŠå¸³è™Ÿï¼Œçµ¦ä¹‹å‰è¨»å†Šçš„ã€Œé˜¿å‹’é “ã€è‡ªå‹•åŠ ä¸Šé–‹ç™¼è€…æ¬Šé™
  if (db[DEV_ACCOUNT_ID] && !db[DEV_ACCOUNT_ID].isDeveloper) {
    db[DEV_ACCOUNT_ID].isDeveloper = true;
    saveAccountDB(db);
    console.log("âœ… èˆŠé–‹ç™¼è€…å¸³è™Ÿå·²è‡ªå‹•å‡ç´šæ¬Šé™");
  }
  return db;
}
function saveAccountDB(db) {
  localStorage.setItem(ACCOUNT_DB_KEY, JSON.stringify(db));
}
// é›™å‘ä¸å¯é€†åŠ å¯†ï¼ˆå°±ç®—äººå“‹ç‡åˆ°å“ˆå¸Œå€¼ï¼Œéƒ½é€†å‘å””å‡ºåŸæœ¬å…§å®¹ï¼‰
function encryptContent(content) {
  return btoa(encodeURIComponent(content.split("").reverse().join("") + DEV_ACCOUNT_ID));
}
// æ ¡é©—é–‹ç™¼è€…å®‰å…¨ç¢¼
function checkDevKey(inputKey) {
  return encryptContent(inputKey) === DEV_KEY_HASH;
}
// å¯†ç¢¼åŠ å¯†
function encryptPwd(pwd) {
  return encryptContent(pwd + "_AENO_PWD");
}

// è¨»å†Šå¸³è™Ÿ
function registerAccount(username, inputDevKey, password, confirmPwd) {
  const db = getAccountDB();
  username = username.trim();
  // åŸºç¤æ ¡é©—
  if (!username || username.length < 2) {
    alert("âŒ å¸³è™Ÿé•·åº¦è‡³å°‘2ä½");
    return false;
  }
  if (!password || password.length < 6) {
    alert("âŒ å¯†ç¢¼é•·åº¦è‡³å°‘6ä½ï¼Œè«‹è¨­å®šæ›´å®‰å…¨çš„å¯†ç¢¼");
    return false;
  }
  if (password !== confirmPwd) {
    alert("âŒ å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´");
    return false;
  }
  if (db[username]) {
    alert("âŒ æ­¤å¸³è™ŸIDå·²è¢«è¨»å†Šï¼Œè«‹æ›´æ›å…¶ä»–ID");
    return false;
  }

  // é–‹ç™¼è€…å¸³è™Ÿå°ˆå±¬æ ¡é©—ï¼ˆæ ¸å¿ƒé–ï¼‰
  const isDevAccount = username === DEV_ACCOUNT_ID;
  if (isDevAccount) {
    if (!inputDevKey || inputDevKey.trim() === "") {
      alert("âŒ é–‹ç™¼è€…å¸³è™Ÿå¿…é ˆè¼¸å…¥å°ˆå±¬å®‰å…¨ç¢¼");
      return false;
    }
    if (!checkDevKey(inputDevKey)) {
      alert("âŒ é–‹ç™¼è€…å®‰å…¨ç¢¼éŒ¯èª¤ï¼Œç„¡æ¬Šè¨»å†Šæ­¤å¸³è™Ÿ");
      console.log("âš ï¸ æœ‰äººå˜—è©¦è¨»å†Šé–‹ç™¼è€…å¸³è™Ÿï¼Œå®‰å…¨ç¢¼æ ¡é©—å¤±æ•—");
      return false;
    }
    console.log("âœ… é–‹ç™¼è€…å¸³è™Ÿæ ¡é©—é€šéï¼Œæº–å‚™è¨»å†Š");
  }

  // å„²å­˜å¸³è™Ÿ
  db[username] = {
    username: username,
    password: encryptPwd(password),
    registerTime: Date.now(),
    lastLoginTime: null,
    fingerprintBind: false,
    isDeveloper: isDevAccount,
  };
  saveAccountDB(db);
  alert(`âœ… è¨»å†ŠæˆåŠŸï¼${isDevAccount ? "é–‹ç™¼è€…å¸³è™Ÿ" : "å¸³è™Ÿ"}å·²å‰µå»ºï¼Œè«‹ä½¿ç”¨å¸³è™Ÿç™»å…¥`);
  // åˆ‡æ›åˆ°ç™»å…¥é 
  switchAuthTab("login");
  document.getElementById("loginID").value = username;
  return true;
}

// ç™»å…¥å¸³è™Ÿ
function loginAccount(username, password) {
  const db = getAccountDB();
  username = username.trim();
  // åŸºç¤æ ¡é©—
  if (!username || !password) {
    alert("âŒ è«‹è¼¸å…¥å®Œæ•´çš„å¸³è™Ÿå’Œå¯†ç¢¼");
    return false;
  }
  const account = db[username];
  if (!account) {
    alert("âŒ æ­¤å¸³è™Ÿæœªè¨»å†Šï¼Œè«‹å…ˆå®Œæˆè¨»å†Š");
    return false;
  }
  // å¯†ç¢¼æ ¡é©—ï¼ˆå…¼å®¹èˆŠå¸³è™Ÿï¼‰
  const newEncrypt = encryptPwd(password);
  // å…¼å®¹èˆŠç‰ˆæœ¬çš„åŠ å¯†æ–¹å¼
  const oldEncrypt = btoa(password.split("").reverse().join("") + "AENO_SALT_2024");
  const pwdMatch = (account.password === newEncrypt) || (account.password === oldEncrypt);
  if (!pwdMatch) {
    alert("âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥");
    console.log("âš ï¸ å¸³è™Ÿç™»å…¥å¯†ç¢¼éŒ¯èª¤", username);
    return false;
  }

  // ç™»å…¥æˆåŠŸ
  account.lastLoginTime = Date.now();
  // è‡ªå‹•å‡ç´šèˆŠå¸³è™Ÿçš„åŠ å¯†æ–¹å¼
  if (account.password === oldEncrypt) {
    account.password = newEncrypt;
    console.log("âœ… èˆŠå¸³è™Ÿå¯†ç¢¼å·²è‡ªå‹•å‡ç´šç‚ºæ–°åŠ å¯†æ–¹å¼");
  }
  saveAccountDB(db);
  localStorage.setItem(CURRENT_ACCOUNT_KEY, username);
  currentPlayer = username;
  isLoggedIn = true;
  isDeveloper = account.isDeveloper || false;

  // é–‹ç™¼è€…æ¬Šé™è§£é–
  if (isDeveloper) {
    document.getElementById("devBlackHoleCard").style.display = "block";
    console.log("ğŸ‘‘ é–‹ç™¼è€…å¸³è™Ÿç™»å…¥æˆåŠŸï¼šé˜¿å‹’é “ï¼Œå·²è§£é–å…¨éƒ¨æ¬Šé™");
  }

  // éš±è—ç™»å…¥æ¡†ï¼Œé¡¯ç¤ºæ˜Ÿçƒé¸æ“‡
  document.getElementById("authOverlay").style.display = "none";
  document.getElementById("planetSelect").style.display = "flex";
  alert(`âœ… ç™»å…¥æˆåŠŸï¼æ­¡è¿å›ä¾†ï¼Œ${username}`);
  return true;
}

// åˆ‡æ›è¨»å†Š/ç™»å…¥tab
function switchAuthTab(tab) {
  document.querySelectorAll(".authTabBtn").forEach(btn => btn.classList.remove("active"));
  document.querySelectorAll(".authForm").forEach(form => form.classList.remove("active"));
  document.querySelector(`.authTabBtn[data-tab="${tab}"]`).classList.add("active");
  document.getElementById(`${tab}Form`).classList.add("active");
}

// é é¢åŠ è¼‰å®Œæˆå¾Œç¶å®šäº‹ä»¶
window.addEventListener("DOMContentLoaded", () => {
  const registerID = document.getElementById("registerID");
  const devKeyInput = document.getElementById("devKeyInput");
  const registerPwd = document.getElementById("registerPwd");
  const registerPwdConfirm = document.getElementById("registerPwdConfirm");
  const registerBtn = document.getElementById("registerBtn");
  const loginID = document.getElementById("loginID");
  const loginPwd = document.getElementById("loginPwd");
  const loginBtn = document.getElementById("loginBtn");

  // ç›£è½è¨»å†Šå¸³è™Ÿè¼¸å…¥ï¼Œåªæœ‰è¼¸å…¥ã€Œé˜¿å‹’é “ã€å…ˆæœƒé¡¯ç¤ºå®‰å…¨ç¢¼è¼¸å…¥æ¡†
  registerID.addEventListener("input", () => {
    const inputName = registerID.value.trim();
    if (inputName === DEV_ACCOUNT_ID) {
      devKeyInput.style.display = "block";
      devKeyInput.setAttribute("required", "required");
    } else {
      devKeyInput.style.display = "none";
      devKeyInput.removeAttribute("required");
    }
  });

  // tabåˆ‡æ›
  document.querySelectorAll(".authTabBtn").forEach(btn => {
    btn.onclick = () => switchAuthTab(btn.dataset.tab);
  });

  // è¨»å†ŠæŒ‰éˆ•
  registerBtn.onclick = () => {
    const username = registerID.value;
    const devKey = devKeyInput.value;
    const pwd = registerPwd.value;
    const confirmPwd = registerPwdConfirm.value;
    registerAccount(username, devKey, pwd, confirmPwd);
  };

  // ç™»å…¥æŒ‰éˆ•
  loginBtn.onclick = () => {
    const username = loginID.value;
    const pwd = loginPwd.value;
    loginAccount(username, pwd);
  };

  // å›è»Šå¿«æ·ç™»å…¥/è¨»å†Š
  loginPwd.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginBtn.click();
  });
  registerPwdConfirm.addEventListener("keydown", (e) => {
    if (e.key === "Enter") registerBtn.click();
  });

  // é åŠ è¼‰å¸³è™Ÿæ•¸æ“šåº«
  getAccountDB();
  console.log("âœ… å¸³è™Ÿç³»çµ±åˆå§‹åŒ–å®Œæˆ");
});
</script>

<!-- å¼•å…¥éŠæˆ²æ ¸å¿ƒJS -->
<script src="game.js"></script>
</body>
</html>
