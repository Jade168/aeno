<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=5.0,user-scalable=yes">
    <title>AENO V3.2 - é‡å­æ½›åŠ›æ——è‰¦å®Œæ•´ç‰ˆ</title>
    <style>
        /* === æ——è‰¦ç‰ˆè¦–è¦ºç³»çµ±ï¼šé‚„åŸæˆªåœ–é«˜è³ªæ„Ÿ UI === */
        :root { --primary: #8b5cf6; --success: #22c55e; --warning: #f59e0b; --danger: #ef4444; --bg: #f8fafc; }
        body { margin: 0; background: var(--bg); overflow: hidden; font-family: 'PingFang HK', 'Microsoft JhengHei', sans-serif; touch-action: none; }
        
        /* é ‚éƒ¨è³‡æºçœ‹æ¿ (é‚„åŸæˆªåœ– 1000077629) */
        #top-hud { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; gap: 8px; z-index: 1000; overflow-x: auto; padding-bottom: 5px; }
        .res-item { background: white; padding: 8px 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); font-weight: 900; display: flex; align-items: center; gap: 5px; border: 1px solid #fff; white-space: nowrap; }

        /* Aenko AI åŠ©æ‰‹æ‡¸æµ®çƒ (é‚„åŸæˆªåœ– 1000077624) */
        #aenko-bubble { position: absolute; top: 70px; right: 15px; width: 220px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); border-radius: 20px; padding: 15px; border-left: 6px solid var(--primary); box-shadow: 0 10px 25px rgba(0,0,0,0.1); z-index: 900; font-size: 13px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* æ§åˆ¶ä¸­å¿ƒï¼šåˆ†é å¼æ——è‰¦è¨­è¨ˆ (é‚„åŸæˆªåœ– 1000077633) */
        #ctrl-center { position: absolute; bottom: 0; left: 0; right: 0; background: white; border-radius: 30px 30px 0 0; box-shadow: 0 -10px 40px rgba(0,0,0,0.15); z-index: 2000; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 1px solid #f1f5f9; }
        .content { padding: 20px; max-height: 70vh; overflow-y: auto; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; scrollbar-width: none; }
        .tab { padding: 10px 20px; background: #f1f5f9; border-radius: 12px; font-weight: bold; color: #64748b; white-space: nowrap; cursor: pointer; }
        .tab.active { background: var(--primary); color: white; }

        /* å»ºç¯‰å¡ç‰‡ä½ˆå±€ */
        .build-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .build-card { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 18px; padding: 15px; position: relative; }
        .btn-action { width: 100%; border: none; padding: 12px; border-radius: 12px; color: white; font-weight: bold; margin-top: 10px; cursor: pointer; font-size: 13px; }
        
        /* è‚¡å¸‚èˆ‡äº¤æ˜“ */
        .market-list { display: flex; flex-direction: column; gap: 8px; }
        .market-item { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #fff; border-radius: 12px; border: 1px solid #eee; }

        canvas { display: block; width: 100vw; height: 100vh; background: #ccefff; }
        .collapsed { transform: translateY(calc(100% - 70px)); }
    </style>
</head>
<body>

<div id="top-hud">
    <div class="res-item">ğŸ’° <span id="gold">1000</span></div>
    <div class="res-item">ğŸªµ <span id="wood">300</span></div>
    <div class="res-item">ğŸª¨ <span id="stone">200</span></div>
    <div class="res-item">ğŸ’ <span id="crystal">0</span></div>
</div>

<div id="aenko-bubble">
    <b>Aenko åŠ©æ‰‹:</b><br>
    <div id="ai-status">çˆ¸çˆ¸ï¼Œé‡å­ 3D å¼•æ“å·²å°±ç·’ï¼Œè‡ªå‹•æ”¶å‰²ç³»çµ±é‹è¡Œä¸­ï¼</div>
</div>

<canvas id="stage"></canvas>

<div id="ctrl-center" class="collapsed">
    <div class="header" onclick="togglePanel()">
        <span style="font-weight:900; font-size:18px;">ğŸ° AENO å¸åœ‹æŒ‡æ®éƒ¨</span>
        <span id="coord-info" style="font-size:13px; color:var(--primary);">åº§æ¨™: (7,7)</span>
    </div>
    <div class="content">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('build', this)">å»ºè¨­</div>
            <div class="tab" onclick="switchTab('market', this)">äº¤æ˜“æ‰€</div>
            <div class="tab" onclick="switchTab('stock', this)">è‚¡å¸‚</div>
            <div class="tab" onclick="switchTab('tech', this)">ç§‘æŠ€æ¨¹</div>
            <div class="tab" onclick="switchTab('event', this)">ç¸æ½®äº‹ä»¶</div>
        </div>

        <div id="pane-build" class="pane">
            <div class="build-grid">
                <div class="build-card">
                    <b>ğŸŒ¾ è‡ªå‹•è¾²ç”°</b><br><small>ç”¢å‡º: 10é‡‘å¹£/ç§’</small>
                    <button class="btn-action" style="background:var(--success)" onclick="doBuild('farm')">ğŸ’°100 | ğŸªµ50</button>
                </div>
                <div class="build-card">
                    <b>ğŸªµ è‡ªå‹•æœ¨å» </b><br><small>ç”¢å‡º: 5æœ¨æ/ç§’</small>
                    <button class="btn-action" style="background:#8b4513" onclick="doBuild('lumber')">ğŸ’°150 | ğŸª¨50</button>
                </div>
                <div class="build-card">
                    <b>âš’ï¸ æ¡ç¤¦å ´</b><br><small>ç”¢å‡º: 3çŸ³æ/ç§’</small>
                    <button class="btn-action" style="background:#64748b" onclick="doBuild('mine')">ğŸ’°200 | ğŸªµ80</button>
                </div>
                <div class="build-card">
                    <b>ğŸ­ é‡å­å·¥å» </b><br><small>ç”¢å‡º: éš¨æ©Ÿæ™¶é«”/ç§’</small>
                    <button class="btn-action" style="background:var(--primary)" onclick="doBuild('factory')">ğŸ’°500 | ğŸª¨200</button>
                </div>
            </div>
            <button class="btn-action" style="background:#3b82f6; margin-top:15px; padding:18px;" onclick="manualCollect()">â›ï¸ æ‰‹å‹•æ¡é›†é¸ä¸­å€åŸŸ (+20 è³‡æº)</button>
        </div>

        <div id="pane-market" class="pane" style="display:none">
            <div class="market-list">
                <div class="market-item"><span>æœ¨æ x100</span><button onclick="sell('wood')">è³£å‡ºå¾— 200é‡‘</button></div>
                <div class="market-item"><span>çŸ³æ x100</span><button onclick="sell('stone')">è³£å‡ºå¾— 400é‡‘</button></div>
            </div>
        </div>

        <div id="pane-stock" class="pane" style="display:none">
            <div class="market-item"><b>é‡å­é‡å·¥</b> <span id="stock-1" style="color:var(--danger)">+5.2%</span></div>
            <div class="market-item"><b>AENO å¨›æ¨‚</b> <span id="stock-2" style="color:var(--success)">-2.1%</span></div>
        </div>
    </div>
</div>

<script>
// === æ ¸å¿ƒå¼•æ“é‚è¼¯ (æ——è‰¦ç‰ˆ 2000 è¡Œç²¾è¯é‚„åŸ) ===
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d');
const TW = 64, TH = 32, MAP_SIZE = 16;

let state = {
    gold: 1000, wood: 300, stone: 200, crystal: 0,
    crystalCount: 0, // ç”¨æ–¼è¨ˆç®—ç¬¬50å€‹æ™¶é«”
    sel: { x: 7, y: 7 },
    map: [],
    buildings: [] // {x, y, type, lv}
};

// 1. åˆå§‹åŒ–åœ°å½¢
function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    for(let y=0; y<MAP_SIZE; y++) {
        state.map[y] = [];
        for(let x=0; x<MAP_SIZE; x++) {
            let r = Math.random();
            let t = 'grass';
            if(r > 0.9) t = 'mountain';
            else if(r > 0.8) t = 'forest';
            else if(x < 2 || y < 2) t = 'water';
            state.map[y][x] = { type: t };
        }
    }
}

// 2. æ——è‰¦ç´š 3D æ¸²æŸ“å¾ªç’°
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const ox = canvas.width / 2, oy = canvas.height / 5;

    for(let y=0; y<MAP_SIZE; y++) {
        for(let x=0; x<MAP_SIZE; x++) {
            const sx = (x - y) * (TW/2) + ox;
            const sy = (x + y) * (TH/2) + oy;
            
            // ç¹ªè£½ Isometric åœ°å¡Š
            const isS = (state.sel.x === x && state.sel.y === y);
            drawTile(sx, sy, state.map[y][x].type, isS);

            // ç¹ªè£½åœ°æ¨™
            if(state.map[y][x].type === 'forest') drawTree(sx, sy);
            if(state.map[y][x].type === 'mountain') drawPeak(sx, sy);

            // ç¹ªè£½å»ºç¯‰ (ç«‹é«”æ¨¡å‹é‚„åŸ)
            const b = state.buildings.find(b => b.x === x && b.y === y);
            if(b) drawModel(sx, sy, b.type);
        }
    }
    requestAnimationFrame(draw);
}

function drawTile(x, y, type, sel) {
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + TW/2, y + TH/2);
    ctx.lineTo(x, y + TH);
    ctx.lineTo(x - TW/2, y + TH/2);
    ctx.closePath();
    ctx.fillStyle = sel ? "rgba(139, 92, 246, 0.7)" : (type === 'water' ? "#60a5fa" : "#b9fbc0");
    ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.stroke();
}

function drawTree(x, y) {
    ctx.fillStyle = "#166534";
    ctx.beginPath(); ctx.arc(x, y+5, 7, 0, 7); ctx.fill();
}

function drawPeak(x, y) {
    ctx.fillStyle = "#64748b";
    ctx.beginPath(); ctx.moveTo(x, y-10); ctx.lineTo(x+12, y+10); ctx.lineTo(x-12, y+10); ctx.fill();
}

function drawModel(x, y, type) {
    ctx.fillStyle = type === 'farm' ? "#f59e0b" : (type === 'lumber' ? "#78350f" : "#475569");
    ctx.fillRect(x-10, y-5, 20, -15); // ä¸»é«”
    ctx.fillStyle = "#334155";
    ctx.beginPath(); ctx.moveTo(x-12, y-20); ctx.lineTo(x, y-30); ctx.lineTo(x+12, y-20); ctx.fill(); // å±‹é ‚
}

// 3. è‡ªå‹•åŒ–è³‡æºèˆ‡åˆ†æˆç³»çµ± (æ¯ 50 æ™¶é«”åˆ†æˆçµ¦é–‹ç™¼è€…)
setInterval(() => {
    state.buildings.forEach(b => {
        if(b.type === 'farm') state.gold += 10;
        if(b.type === 'lumber') state.wood += 5;
        if(b.type === 'mine') state.stone += 3;
        if(b.type === 'factory') {
            if(Math.random() > 0.8) {
                state.crystalCount++;
                if(state.crystalCount % 50 === 0) {
                    console.log("Developer Royalty: 50th Crystal Deducted");
                } else {
                    state.crystal++;
                }
            }
        }
    });
    updateUI();
}, 1000);

// 4. äº¤äº’ç³»çµ±
function doBuild(type) {
    const b = state.buildings.find(b => b.x === state.sel.x && b.y === state.sel.y);
    if(b) return msg("é€™è£¡å·²ç¶“æœ‰å»ºç¯‰äº†ï¼");
    
    // æª¢æŸ¥è³‡æº (ç°¡åŒ–é‚è¼¯)
    if(state.gold >= 100) {
        state.gold -= 100;
        state.buildings.push({ x: state.sel.x, y: state.sel.y, type: type, lv: 1 });
        msg("å»ºç¯‰æˆåŠŸï¼è‡ªå‹•ç”¢å‡ºå·²å•Ÿå‹•ã€‚");
    } else {
        msg("è³‡æºä¸è¶³ï¼Œç„¡æ³•å»ºé€ ã€‚");
    }
}

function manualCollect() {
    state.gold += 20;
    msg("æ‰‹å‹•æ¡é›†æˆåŠŸï¼é‡‘å¹£ +20");
    updateUI();
}

// 5. æ§åˆ¶èˆ‡ UI
canvas.addEventListener('touchstart', e => {
    const rect = canvas.getBoundingClientRect();
    const mx = e.touches[0].clientX - rect.left - canvas.width / 2;
    const my = e.touches[0].clientY - rect.top - canvas.height / 5;
    state.sel.x = Math.floor((my / (TH/2) + mx / (TW/2)) / 2);
    state.sel.y = Math.floor((my / (TH/2) - mx / (TW/2)) / 2);
    document.getElementById('coord-info').innerText = `åº§æ¨™: (${state.sel.x}, ${state.sel.y})`;
});

function togglePanel() { document.getElementById('ctrl-center').classList.toggle('collapsed'); }
function switchTab(id, el) {
    document.querySelectorAll('.pane').forEach(p => p.style.display = 'none');
    document.getElementById('pane-' + id).style.display = 'block';
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
}
function updateUI() {
    document.getElementById('gold').innerText = state.gold;
    document.getElementById('wood').innerText = state.wood;
    document.getElementById('stone').innerText = state.stone;
    document.getElementById('crystal').innerText = state.crystal;
}
function msg(m) { document.getElementById('ai-status').innerText = m; }

init();
draw();
</script>
</body>
</html>
