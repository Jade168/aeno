<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,maximum-scale=1.0">
<title>AENO V3 文明帝國（完整版）</title>

<style>
/* 你原本的 CSS 直接放在這裏最上面 */
* { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans HK",sans-serif; }
body { background:#111; color:#fff; overflow:hidden; user-select:none; touch-action:none; }
#loginScreen { position:fixed; inset:0; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px; z-index:9999; }
#loginScreen input { padding:12px 20px; border-radius:8px; border:none; font-size:16px; width:80%; max-width:300px; background:#222; color:#fff; }
#loginScreen button { padding:12px 30px; border-radius:8px; border:none; font-size:16px; background:#0070ff; color:#fff; cursor:pointer; }
#loginScreen .guestBtn { background:#444; }
#bootScreen { position:fixed; inset:0; background:#000; color:#0f0; display:flex; align-items:center; justify-content:center; font-size:22px; z-index:9998; display:none; }
#gameCanvas { display:block; width:100vw; height:100vh; position:absolute; top:0; left:0; z-index:1; }
#mainPanel { position:fixed; top:10px; left:10px; width:360px; max-width:90vw; height:560px; max-height:80vh; background:rgba(0,0,0,0.85); border:1px solid #444; border-radius:10px; padding:10px; overflow:hidden; display:flex; flex-direction:column; z-index:10; }
.tabBar { display:flex; gap:6px; margin-bottom:8px; flex-wrap:wrap; }
.tabBtn { padding:6px 10px; background:#333; border:none; border-radius:6px; color:#fff; font-size:12px; cursor:pointer; flex:1; min-width:45px; }
.tabBtn.active { background:#0070ff; }
.tabPage { display:none; flex:1; overflow:auto; padding-right:6px; }
.tabPage.active { display:block; }
.row { display:flex; justify-content:space-between; padding:4px 0; font-size:14px; border-bottom:1px solid #333; }
.btn { padding:8px 10px; background:#0070ff; border:none; border-radius:6px; color:#fff; cursor:pointer; margin-top:4px; width:100%; }
.btn.danger { background:#c43; }
.btn.gray { background:#444; }
.btn.small { width:auto; flex:1; }
.hidden { display:none !important; }
#chatBox { position:fixed; bottom:10px; right:10px; width:320px; max-width:90vw; height:400px; max-height:50vh; background:rgba(0,0,0,0.85); border:1px solid #555; border-radius:10px; display:flex; flex-direction:column; z-index:10; }
#chatLog { flex:1; padding:8px; font-size:12px; overflow-y:auto; }
#chatInput { width:100%; padding:8px; background:#222; border:none; color:#fff; border-radius:6px 0 0 6px; }
#sysLog { height:80px; overflow-y:auto; font-size:12px; color:#ccc; background:#111; padding:4px; margin-top:6px; border-radius:6px; }
</style>

</head>
<body>

<!-- 登入畫面 -->
<div id="loginScreen">
  <h1>AENO V3 文明帝國</h1>
  <input type="text" id="userName" placeholder="請輸入用戶名">
  <button id="loginBtn">登入遊戲</button>
  <button id="guestBtn" class="guestBtn">游客登入</button>
</div>

<!-- 載入畫面 -->
<div id="bootScreen">載入 AENO V3 文明帝國...</div>

<!-- 遊戲畫布 -->
<canvas id="gameCanvas"></canvas>

<!-- 面板 -->
<div id="mainPanel" class="hidden">
  <div class="tabBar">
    <button class="tabBtn active" data-tab="tabMain">主頁</button>
    <button class="tabBtn" data-tab="tabBuild">建造</button>
    <button class="tabBtn" data-tab="tabMarket">交易所</button>
    <button class="tabBtn" data-tab="tabChat">助手</button>
  </div>

  <div id="tabMain" class="tabPage active">
    <div class="row"><span>用戶名</span><span id="userNameDisplay">游客</span></div>
    <div class="row"><span>金幣</span><span id="statGold">0</span></div>
    <div class="row"><span>AENO</span><span id="statAeno">0.000000</span></div>
    <div class="row"><span>木材</span><span id="statWood">0</span></div>
    <div class="row"><span>石頭</span><span id="statStone">0</span></div>
    <div class="row"><span>鐵礦</span><span id="statIron">0</span></div>
    <div class="row"><span>糧食</span><span id="statFood">0</span></div>
    <div id="sysLog"></div>
  </div>

  <div id="tabBuild" class="tabPage">
    <button class="btn buildBtn" data-build="house">建造 房屋</button>
    <button class="btn buildBtn" data-build="farm">建造 農田</button>
    <button class="btn buildBtn" data-build="lumber">建造 伐木場</button>
  </div>

  <div id="tabMarket" class="tabPage">
    <div class="row"><span>市價（示例）</span></div>
    <div style="display:flex; gap:6px;">
      <input class="btn small" id="btnPlayAd" type="button" value="播放廣告">
      <input class="btn small gray" id="btnStopAd" type="button" value="停止">
    </div>
  </div>

  <div id="tabChat" class="tabPage">
    <div><button class="btn" id="openChatBtn">開啟助手</button></div>
  </div>
</div>

<!-- 聊天視窗 -->
<div id="chatBox" class="hidden">
  <div id="chatLog"></div>
  <div style="display:flex; gap:6px; margin-top:6px;">
    <input id="chatInput" placeholder="輸入指令：自動 / 停止 / 升級" class="btn small" />
    <button class="btn small" id="chatSend">送出</button>
    <button class="btn small gray" id="chatClose">關閉</button>
  </div>
</div>

<!-- 音樂播放器 -->
<audio id="adAudio" loop crossorigin="anonymous"></audio>

<!-- three.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<!-- 遊戲邏輯 -->
<script src="game.js"></script>

<script>
// =========================
// 登入 & 初始化
// =========================

const loginScreen = document.getElementById("loginScreen");
const bootScreen = document.getElementById("bootScreen");
const mainPanel = document.getElementById("mainPanel");
const userNameDisplay = document.getElementById("userNameDisplay");

document.getElementById("loginBtn").onclick = () => {
  const val = document.getElementById("userName").value.trim();
  if (!val) {
    alert("請輸入用戶名！");
    return;
  }
  startGame(val);
};

document.getElementById("guestBtn").onclick = () => {
  startGame("游客");
};

function startGame(name) {
  loginScreen.style.display = "none";
  bootScreen.style.display = "flex";

  setTimeout(() => {
    bootScreen.style.display = "none";
    mainPanel.classList.remove("hidden");

    userNameDisplay.textContent = name;
    if (typeof initGame === "function") {
      initGame(name);
    }
  }, 1200);
}

// =========================
// 面板 tab
// =========================

Array.from(document.querySelectorAll(".tabBtn")).forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll(".tabBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".tabPage").forEach(p=>p.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  };
});

// =========================
// Chat
// =========================

document.getElementById("openChatBtn").onclick = () => {
  document.getElementById("chatBox").classList.remove("hidden");
};

document.getElementById("chatClose").onclick = () => {
  document.getElementById("chatBox").classList.add("hidden");
};

document.getElementById("chatSend").onclick = () => {
  const txt = document.getElementById("chatInput").value.trim();
  if (txt) {
    const log = document.getElementById("chatLog");
    log.innerHTML += `<div><b>你：</b>${txt}</div>`;
    log.scrollTop = log.scrollHeight;
    document.getElementById("chatInput").value = "";
  }
};
</script>

</body>
</html>
