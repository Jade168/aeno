<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<title>AENO V3 æ–‡æ˜å¸åœ‹ï¼ˆå®Œæ•´ç‰ˆï¼‰</title>

<style>
:root{
  --bg:#dff1ff;
  --card:#ffffff;
  --shadow:0 14px 40px rgba(0,0,0,.18);
  --line:#e6eefc;
  --blue:#3b82f6;
  --green:#22c55e;
  --orange:#f59e0b;
  --red:#ef4444;
  --pink:#ec4899;
  --purple:#8b5cf6;
  --text:#0f172a;
}

html,body{
  margin:0;padding:0;height:100%;
  background:linear-gradient(#e9f7ff,#dceeff);
  overflow:hidden;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans HK", sans-serif;
  color:var(--text);
}

#root{position:absolute; inset:0; overflow:hidden;}
canvas{
  position:absolute; inset:0;
  background:linear-gradient(#bfe8ff,#dff1ff);
  touch-action:none;
}

.floatBar{
  position:absolute;
  top:10px; left:10px; right:10px;
  display:flex; gap:10px;
  z-index:20;
  align-items:center;
  justify-content:space-between;
}

.titleBox{
  flex:1;
  background:rgba(255,255,255,.82);
  border:1px solid rgba(255,255,255,.6);
  border-radius:20px;
  padding:10px 14px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:center;
  gap:12px;
}

.logo{
  width:44px;height:44px;
  border-radius:50%;
  background:linear-gradient(#34d399,#22c55e);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;color:#fff;
  box-shadow:0 8px 20px rgba(0,0,0,.18);
}

.titleText{
  line-height:1.05;
}
.titleText b{font-size:16px;}
.titleText span{font-size:12px; opacity:.7}

.topBtns{
  display:flex;
  gap:8px;
}
.circleBtn{
  width:54px;height:54px;border-radius:50%;
  border:none;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
  font-size:20px;
  font-weight:900;
  cursor:pointer;
}
.btnBlue{background:linear-gradient(#60a5fa,#3b82f6); color:#fff;}
.btnGreen{background:linear-gradient(#4ade80,#22c55e); color:#fff;}
.btnOrange{background:linear-gradient(#fdba74,#f97316); color:#fff;}
.btnPurple{background:linear-gradient(#c4b5fd,#8b5cf6); color:#fff;}

/* é¢æ¿å¯æ‰‹å‹•æ”¾å¤§ç¸®å° */
.panel{
  position:absolute;
  top:88px; left:10px;
  width:24vw;
  height:24vh;
  background:rgba(255,255,255,.92);
  border:1px solid rgba(255,255,255,.6);
  border-radius:22px;
  box-shadow:var(--shadow);
  backdrop-filter: blur(12px);
  z-index:30;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  resize:both;
  min-width:300px;
  min-height:400px;
}

.panel.hidden{display:none;}

.panel header{
  padding:10px 12px;
  background:linear-gradient(#ffffff,#f3f7ff);
  border-bottom:1px solid var(--line);
  display:flex;
  align-items:center;
  justify-content:space-between;
  cursor:move;
  user-select:none;
}

.panel header b{font-size:14px;}
.panel header small{opacity:.65}

.panelBody{
  padding:10px;
  overflow:auto;
  flex:1;
}

.tabs{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:10px;
}

.tabBtn{
  border:none;
  padding:8px 12px;
  border-radius:16px;
  background:#f1f5ff;
  cursor:pointer;
  font-weight:700;
  font-size:12px;
}
.tabBtn.active{
  background:linear-gradient(#60a5fa,#3b82f6);
  color:#fff;
}

.card{
  background:rgba(255,255,255,.95);
  border:1px solid var(--line);
  border-radius:18px;
  padding:10px;
  margin-bottom:10px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.row{
  display:flex;
  justify-content:space-between;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}

.small{font-size:12px; opacity:.72}

.bigStat{
  font-size:14px;
  font-weight:900;
}

.btn{
  border:none;
  padding:10px 12px;
  border-radius:16px;
  cursor:pointer;
  font-weight:900;
  font-size:13px;
  box-shadow:0 10px 20px rgba(0,0,0,.12);
}
.btn.full{width:100%}
.bBlue{background:linear-gradient(#60a5fa,#3b82f6);color:#fff}
.bGreen{background:linear-gradient(#4ade80,#22c55e);color:#fff}
.bOrange{background:linear-gradient(#fdba74,#f97316);color:#fff}
.bRed{background:linear-gradient(#fb7185,#ef4444);color:#fff}
.bPurple{background:linear-gradient(#c4b5fd,#8b5cf6);color:#fff}
.bGray{background:linear-gradient(#e2e8f0,#cbd5e1);color:#111}

.input{
  width:100%;
  border-radius:14px;
  border:1px solid #dbeafe;
  padding:10px;
  font-weight:800;
  font-size:13px;
  outline:none;
}

/* AIé¢æ¿å¯æ”¾å¤§ç¸®å° */
.aiPanel{
  position:absolute;
  right:10px;
  top:120px;
  width:24vw;
  height:24vh;
  background:rgba(255,255,255,.92);
  border-radius:22px;
  border:1px solid rgba(255,255,255,.6);
  box-shadow:var(--shadow);
  z-index:35;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  resize:both;
  min-width:300px;
  min-height:400px;
}

.aiPanel.hidden{display:none;}

.aiPanel header{
  padding:10px 12px;
  background:linear-gradient(#ffffff,#f3f7ff);
  border-bottom:1px solid var(--line);
  cursor:move;
  user-select:none;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.chat{
  flex:1;
  padding:10px;
  overflow:auto;
  font-size:13px;
}

.msg{
  margin-bottom:8px;
  padding:10px 12px;
  border-radius:16px;
  background:#f3f7ff;
  border:1px solid #dbeafe;
}

.msg.ai{background:#fff7ed;border:1px solid #fed7aa}
.msg.sys{background:#f1f5f9;border:1px solid #e2e8f0}
.msg b{color:#2563eb}

.chatInput{
  display:flex;
  gap:8px;
  padding:10px;
  border-top:1px solid var(--line);
  background:rgba(255,255,255,.9);
}

.chatInput input{
  flex:1;
  border-radius:16px;
  border:1px solid #dbeafe;
  padding:10px;
  font-weight:900;
  outline:none;
}

.chatInput button{
  width:90px;
  border:none;
  border-radius:16px;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(#4ade80,#22c55e);
  color:#fff;
}

.floatingMini{
  position:absolute;
  right:12px;
  bottom:12px;
  z-index:60;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.miniBtn{
  width:56px;height:56px;border-radius:50%;
  border:none;
  cursor:pointer;
  box-shadow:0 12px 28px rgba(0,0,0,.18);
  font-size:22px;
  font-weight:900;
}

.miniA{background:linear-gradient(#fde68a,#f59e0b); color:#000;}
.miniP{background:linear-gradient(#c4b5fd,#8b5cf6); color:#fff;}
.miniS{background:linear-gradient(#93c5fd,#3b82f6); color:#fff;}

.toast{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  bottom:18px;
  background:rgba(0,0,0,.75);
  color:#fff;
  padding:10px 14px;
  border-radius:16px;
  font-weight:900;
  z-index:100;
  display:none;
}

/* ç™»éŒ„å½ˆçª— */
#loginModal{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.5);
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
}
.loginBox{
  background:#fff;
  padding:25px 30px;
  border-radius:20px;
  width:90%;
  max-width:380px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
.loginBox h3{
  margin:0 0 15px;
  text-align:center;
}
.loginBox input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:12px;
  border:1px solid #ddd;
  box-sizing:border-box;
  font-size:15px;
}
.loginBox button{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  background:linear-gradient(90deg,#3b82f6,#8b5cf6);
  color:#fff;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
}

/* æ˜Ÿçƒé¸æ“‡å½ˆçª— - 20å€‹æ˜Ÿçƒ + 1å€‹é»‘æ´ */
#planetModal{
  position:fixed;
  top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,0.5);
  z-index:9998;
  display:none;
  align-items:center;
  justify-content:center;
}
.planetBox{
  background:#fff;
  padding:25px 30px;
  border-radius:20px;
  width:90%;
  max-width:380px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
}
.planetBox h3{
  margin:0 0 15px;
  text-align:center;
}
.planetBox select{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:15px;
}
.planetBox button{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  background:linear-gradient(90deg,#22c55e,#3b82f6);
  color:#fff;
  font-weight:bold;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- ç™»éŒ„å½ˆçª—ï¼šIDå¿…å¡«ï¼Œå¯†ç¢¼ä»»æ„ -->
<div id="loginModal">
  <div class="loginBox">
    <h3>AENO æœƒå“¡ç™»éŒ„</h3>
    <input id="loginId" type="text" placeholder="è«‹è¼¸å…¥ç©å®¶IDï¼ˆå¿…å¡«ï¼‰">
    <input id="loginPwd" type="password" placeholder="å¯†ç¢¼ï¼ˆä»»æ„è¼¸å…¥å³å¯ï¼‰">
    <button onclick="doLogin()">ç™»éŒ„</button>
  </div>
</div>

<!-- 20å€‹æ˜Ÿçƒ + 1å€‹é»‘æ´é¸æ“‡ -->
<div id="planetModal">
  <div class="planetBox">
    <h3>é¸æ“‡ä½ çš„æ˜Ÿçƒ</h3>
    <select id="planetSelect">
      <option value="earth">ç¶ åŸæ˜Ÿ - å¹³è¡¡å‹</option>
      <option value="mars">èµ¤éµæ˜Ÿ - ç¤¦ç”¢åŠ æˆ</option>
      <option value="ocean">ç¢§æµ·æ˜Ÿ - ç³§é£ŸåŠ æˆ</option>
      <option value="lava">ç†”ç«æ˜Ÿ - é‡‘å¹£åŠ æˆ</option>
      <option value="ice">å†°å°æ˜Ÿ - å·¥æ¥­åŠ æˆ</option>
      <option value="wind">ç–¾é¢¨æ˜Ÿ - é€Ÿåº¦åŠ æˆ</option>
      <option value="stone">å·¨å²©æ˜Ÿ - çŸ³é ­åŠ æˆ</option>
      <option value="wood">æ£®ç¾…æ˜Ÿ - æœ¨æåŠ æˆ</option>
      <option value="iron">é‹¼éµæ˜Ÿ - éµç¤¦åŠ æˆ</option>
      <option value="gold">é»ƒé‡‘æ˜Ÿ - é‡‘å¹£è¶…åŠ æˆ</option>
      <option value="star">æ˜Ÿå…‰æ˜Ÿ - ç§‘æŠ€åŠ æˆ</option>
      <option value="moon">æœˆå½±æ˜Ÿ - é˜²ç¦¦åŠ æˆ</option>
      <option value="sun">çƒˆæ—¥æ˜Ÿ - äººå£åŠ æˆ</option>
      <option value="cloud">é›²æµ·æ˜Ÿ - è³‡æºç·©è¡</option>
      <option value="thunder">é›·éœ†æ˜Ÿ - æ©Ÿå™¨äººåŠ æˆ</option>
      <option value="crystal">æ°´æ™¶æ˜Ÿ - ç‰¹æ®Šè³‡æº</option>
      <option value="shadow">æš—å½±æ˜Ÿ - éš±è—åŠ æˆ</option>
      <option value="holy">è–å…‰æ˜Ÿ - å…¨å±¬æ€§å°å¹…åŠ æˆ</option>
      <option value="void">è™›ç©ºæ˜Ÿ - ç¨€æœ‰æ‰è½åŠ æˆ</option>
      <option value="eternal">æ°¸æ†æ˜Ÿ - å…¨è³‡æºåŠ æˆ</option>
      <option value="blackhole">é»‘æ´ - çµ‚æ¥µç‰¹æ®Šæ˜Ÿçƒ</option>
    </select>
    <button onclick="startGameAfterSelect()">é€²å…¥å¸åœ‹</button>
  </div>
</div>

<div id="root">
  <canvas id="cv"></canvas>

  <div class="floatBar">
    <div class="titleBox">
      <div class="logo">A</div>
      <div class="titleText">
        <b>AENO V3 æ–‡æ˜å¸åœ‹</b><br>
        <span id="statusText">è¼‰å…¥ä¸­...</span>
      </div>
    </div>

    <div class="topBtns">
      <button class="circleBtn btnBlue" onclick="centerView()">ä¸­</button>
      <button class="circleBtn btnGreen" onclick="zoomIn()">+</button>
      <button class="circleBtn btnOrange" onclick="zoomOut()">-</button>
      <button class="circleBtn btnPurple" onclick="manualSave()">å­˜</button>
    </div>
  </div>

  <!-- ä¸»é¢æ¿ -->
  <div id="panel" class="panel">
    <header>
      <div>
        <b>å¸åœ‹å¤§é¢æ¿</b><br>
        <small id="panelSub">æ‰€æœ‰ç³»çµ±æ•´åˆ</small>
      </div>
      <button class="btn bGray" onclick="togglePanel()">æ”¶èµ·</button>
    </header>

    <div class="panelBody">
      <div class="tabs">
        <button class="tabBtn active" data-tab="res" onclick="switchTab('res')">è³‡æº</button>
        <button class="tabBtn" data-tab="build" onclick="switchTab('build')">å»ºè¨­</button>
        <button class="tabBtn" data-tab="market" onclick="switchTab('market')">äº¤æ˜“æ‰€</button>
        <button class="tabBtn" data-tab="stock" onclick="switchTab('stock')">è‚¡å¸‚</button>
        <button class="tabBtn" data-tab="tech" onclick="switchTab('tech')">ç§‘æŠ€æ¨¹</button>
        <button class="tabBtn" data-tab="events" onclick="switchTab('events')">äº‹ä»¶</button>
        <button class="tabBtn" data-tab="ads" onclick="switchTab('ads')">å»£å‘Š/æ­Œæ›²</button>
        <button class="tabBtn" data-tab="robot" onclick="switchTab('robot')">æ©Ÿå™¨äºº</button>
      </div>

      <!-- è³‡æº -->
      <div class="tab" id="tab_res">
        <div class="card">
          <div class="row">
            <div class="bigStat">ğŸŒ² æœ¨æ: <span id="r_wood">0</span></div>
            <div class="bigStat">ğŸª¨ çŸ³é ­: <span id="r_stone">0</span></div>
          </div>
          <div class="row">
            <div class="bigStat">â›ï¸ éµç¤¦: <span id="r_iron">0</span></div>
            <div class="bigStat">ğŸŒ¾ ç³§é£Ÿ: <span id="r_food">0</span></div>
          </div>
          <div class="row">
            <div class="bigStat">ğŸª™ é‡‘å¹£: <span id="r_coin">0</span></div>
            <div class="bigStat">ğŸ’ AENO: <span id="r_aeno">0</span></div>
          </div>
          <div class="row small">
            <div>ğŸ‘¥ äººå£: <span id="r_pop">0</span>/<span id="r_popcap">0</span></div>
            <div>ğŸ§‘â€ğŸ”§ å·¥äºº: <span id="r_workers">0</span></div>
          </div>
          <div class="row small">
            <div>é ˜åœŸåŠå¾‘: <span id="r_radius">0</span></div>
            <div>é›¢ç·šæ”¶ç›Š: <span id="r_offline">0</span> ç§’</div>
          </div>
        </div>

        <div class="card">
          <div class="row">
            <button class="btn bPurple" onclick="toggleAutoBuild()">AIè‡ªå‹•å»ºè¨­: <span id="autoTxt">ON</span></button>
            <button class="btn bOrange" onclick="toggleAutoExpand()">è‡ªå‹•æ“´åœŸ: <span id="expandTxt">ON</span></button>
          </div>
          <div class="row">
            <button class="btn bBlue full" onclick="centerView()">ğŸ“ å›åˆ°ä¸­å¿ƒ</button>
          </div>
        </div>
      </div>

      <!-- å»ºè¨­ -->
      <div class="tab" id="tab_build" style="display:none">
        <div class="card">
          <div class="small">é»åœ°åœ–æ ¼ä»”å¾Œï¼Œå¯å»ºé€ ï¼ˆé ˜åœŸå…§æ‰å¯ï¼‰ã€‚AIäº¦æœƒè‡ªå‹•èµ·å±‹/è¾²ç”°/ä¼æœ¨ã€‚</div>
        </div>

        <div class="card">
          <div class="row"><b>å»ºç¯‰åˆ—è¡¨</b></div>
          <div class="row">
            <button class="btn bGreen" onclick="setBuildMode('house')">ğŸ  æˆ¿å±‹</button>
            <button class="btn bBlue" onclick="setBuildMode('farm')">ğŸŒ¾ è¾²ç”°</button>
          </div>
          <div class="row">
            <button class="btn bOrange" onclick="setBuildMode('lumber')">ğŸª“ ä¼æœ¨å ´</button>
            <button class="btn bPurple" onclick="setBuildMode('mine')">â›ï¸ ç¤¦å ´</button>
          </div>
          <div class="row">
            <button class="btn bRed" onclick="setBuildMode('wall')">ğŸ§± åŸç‰†</button>
            <button class="btn bGray" onclick="setBuildMode(null)">å–æ¶ˆ</button>
          </div>
          <div class="small" id="buildModeText">å»ºé€ æ¨¡å¼ï¼šç„¡</div>
        </div>

        <div class="card">
          <b>å‡ç´šä¸­å¿ƒ</b>
          <div class="small">é¸ä¸­å»ºç¯‰å¾Œå¯å‡ç´šï¼ˆAIäº¦æœƒåŠè‡ªå‹•å‡ç´šï¼‰ã€‚</div>
          <button class="btn bBlue full" onclick="upgradeSelected()">â¬†ï¸ å‡ç´šé¸ä¸­å»ºç¯‰</button>
        </div>

        <div class="card">
          <b>æ“´å¼µé ˜åœŸï¼ˆæ‰‹å‹•ï¼‰</b>
          <div class="small">ä¸»è¦ç”±ç³»çµ±è‡ªå‹•æ“´å¼µï¼Œä½†ä½ å¯æ‰‹å‹•æ¨é€²ã€‚</div>
          <button class="btn bOrange full" onclick="expandTerritoryManual()">ğŸ—ºï¸ ç«‹å³æ“´å¼µ</button>
        </div>
      </div>

      <!-- äº¤æ˜“æ‰€ -->
      <div class="tab" id="tab_market" style="display:none">
        <div class="card">
          <b>äº¤æ˜“æ‰€ï¼ˆè³‡æºæ›é‡‘å¹£ï¼‰</b>
          <div class="small">åƒ¹æ ¼æœƒæ³¢å‹•ï¼ˆæ¯3åˆ†é˜æ›´æ–°ï¼‰ã€‚</div>
        </div>

        <div class="card">
          <div class="row">
            <div>æœ¨æåƒ¹æ ¼: <b id="p_wood">0</b></div>
            <div>çŸ³é ­åƒ¹æ ¼: <b id="p_stone">0</b></div>
          </div>
          <div class="row">
            <div>éµç¤¦åƒ¹æ ¼: <b id="p_iron">0</b></div>
            <div>ç³§é£Ÿåƒ¹æ ¼: <b id="p_food">0</b></div>
          </div>
          <hr>
          <input id="tradeAmt" class="input" type="number" value="20" min="1">
          <div class="row">
            <button class="btn bGreen" onclick="trade('buy','wood')">è²·æœ¨</button>
            <button class="btn bOrange" onclick="trade('sell','wood')">è³£æœ¨</button>
          </div>
          <div class="row">
            <button class="btn bGreen" onclick="trade('buy','stone')">è²·çŸ³</button>
            <button class="btn bOrange" onclick="trade('sell','stone')">è³£çŸ³</button>
          </div>
          <div class="row">
            <button class="btn bGreen" onclick="trade('buy','iron')">è²·éµ</button>
            <button class="btn bOrange" onclick="trade('sell','iron')">è³£éµ</button>
          </div>
          <div class="row">
            <button class="btn bGreen" onclick="trade('buy','food')">è²·ç³§</button>
            <button class="btn bOrange" onclick="trade('sell','food')">è³£ç³§</button>
          </div>
        </div>
      </div>

      <!-- è‚¡å¸‚ -->
      <div class="tab" id="tab_stock" style="display:none">
        <div class="card">
          <b>è‚¡å¸‚ï¼ˆç°¡åŒ–ç‰ˆï¼‰</b>
          <div class="small">ç©å®¶å¯æŠ•è³‡æ˜Ÿçƒå…¬å¸ã€‚æ¯180ç§’æ³¢å‹•ã€‚</div>
        </div>

        <div class="card">
          <div class="row">
            <div>ğŸ­ å·¥æ¥­è‚¡: <b id="s_ind">0</b></div>
            <button class="btn bGreen" onclick="stock('buy','ind')">è²·</button>
            <button class="btn bOrange" onclick="stock('sell','ind')">è³£</button>
          </div>
          <div class="row">
            <div>ğŸš€ å¤ªç©ºè‚¡: <b id="s_space">0</b></div>
            <button class="btn bGreen" onclick="stock('buy','space')">è²·</button>
            <button class="btn bOrange" onclick="stock('sell','space')">è³£</button>
          </div>
          <div class="row">
            <div>ğŸŒ¿ è¾²æ¥­è‚¡: <b id="s_farm">0</b></div>
            <button class="btn bGreen" onclick="stock('buy','farm')">è²·</button>
            <button class="btn bOrange" onclick="stock('sell','farm')">è³£</button>
          </div>
          <div class="small">ï¼ˆè‚¡å¸‚æ”¶ç›Šæœƒè½‰æˆé‡‘å¹£ï¼Œæ­£å¼ç‰ˆå¯é€£æ¥ Firebaseã€‚ï¼‰</div>
        </div>
      </div>

      <!-- ç§‘æŠ€æ¨¹ -->
      <div class="tab" id="tab_tech" style="display:none">
        <div class="card">
          <b>ç§‘æŠ€æ¨¹ï¼ˆéª¨æ¶ï¼‰</b>
          <div class="small">ç§‘æŠ€æœƒå½±éŸ¿æ•ˆç‡ã€è§£é–å»ºç¯‰ã€æ©Ÿå™¨äººã€‚</div>
        </div>

        <div class="card">
          <div class="row">
            <div>ğŸ”§ å·¥æ¥­Lv: <b id="t_ind">0</b></div>
            <button class="btn bBlue" onclick="research('ind')">ç ”ç©¶</button>
          </div>
          <div class="row">
            <div>ğŸ›¡ï¸ é˜²ç¦¦Lv: <b id="t_def">0</b></div>
            <button class="btn bBlue" onclick="research('def')">ç ”ç©¶</button>
          </div>
          <div class="row">
            <div>ğŸ¤– æ©Ÿå™¨äººLv: <b id="t_robot">0</b></div>
            <button class="btn bBlue" onclick="research('robot')">ç ”ç©¶</button>
          </div>
        </div>
      </div>

      <!-- äº‹ä»¶ -->
      <div class="tab" id="tab_events" style="display:none">
        <div class="card">
          <b>äº‹ä»¶ä¸­å¿ƒ</b>
          <div class="small">ç¸æ½® / æ å¥ª / æ¢ç´¢äº‹ä»¶éƒ½æœƒè¨˜éŒ„ã€‚</div>
        </div>

        <div class="card">
          <div class="row">
            <div>ç¸æ½®å€’æ•¸: <b id="beastTimer">0</b>s</div>
            <button class="btn bRed" onclick="forceBeast()">å¼·åˆ¶ç¸æ½®(æ¸¬è©¦)</button>
          </div>
          <div class="row">
            <div>é‡è »ç¢ç‰‡: <b id="shards">0</b></div>
            <button class="btn bOrange" onclick="collectLoot()">æ”¶å–æˆ°åˆ©å“</button>
          </div>
          <div class="small">ç¢ç‰‡æ¯”ä¾‹æœƒå½±éŸ¿ AENO å¢é•·ã€‚</div>
        </div>
      </div>

      <!-- å»£å‘Š -->
      <div class="tab" id="tab_ads" style="display:none">
        <div class="card">
          <b>å»£å‘Š / æ­Œæ›²</b>
          <div class="small">
            å»£å‘Šå•†æœªä¾†åªè¦æ”¹ ads.jsonï¼Œå°±å¯ä»¥æ›æ­Œ/æ›å»£å‘Šï¼Œä¸ç”¨æ›´æ–°ç¨‹å¼ã€‚
          </div>
        </div>

        <div class="card">
          <div class="row">
            <button class="btn bPurple" onclick="unlockAudio()">ğŸ”Š è§£é–éŸ³è¨Š</button>
            <button class="btn bGreen" onclick="playAdSong()">ğŸµ æ’­æ”¾å»£å‘Šæ­Œ</button>
          </div>
          <div class="row small">
            <div>ä»Šæ—¥è½æ­Œæ¯”ä¾‹: <b id="adRatio">0%</b></div>
            <div>å†·å»: <b id="adCd">0</b>s</div>
          </div>
          <div class="small" id="adNow">æœªæ’­æ”¾</div>
        </div>
      </div>

      <!-- æ©Ÿå™¨äºº -->
      <div class="tab" id="tab_robot" style="display:none">
        <div class="card">
          <b>æ©Ÿå™¨äººä¸­å¿ƒ</b>
          <div class="small">æ©Ÿå™¨äººæœƒå¤–å‡ºå¸¶å›è³‡æºï¼Œä¹Ÿå¯èƒ½éš¨æ©Ÿå·ä½  20%ã€‚</div>
        </div>

        <div class="card">
          <div class="row">
            <div>ç‹€æ…‹: <b id="robotStatus">å¾…å‘½</b></div>
            <button class="btn bBlue" onclick="sendRobot()">æ´¾å‡ºæ©Ÿå™¨äºº</button>
          </div>
          <div class="row small">
            <div>å›ä¾†å€’æ•¸: <b id="robotTimer">0</b>s</div>
            <div>æ å¥ªå€’æ•¸: <b id="stealTimer">0</b>s</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- AI åŠ©æ‰‹é¢æ¿ -->
  <div id="aiPanel" class="aiPanel">
    <header>
      <div>
        <b>ğŸ¾ AIåŠ©æ‰‹ - Aenko</b><br>
        <small>å·¡é‚ä¸­ãƒ»å¤–æ›å¼æ–‡æ˜ç®¡ç†</small>
      </div>
      <button class="btn bGray" onclick="toggleAI()">æ”¶èµ·</button>
    </header>

    <div class="chat" id="chat"></div>

    <div class="chatInput">
      <input id="cmd" placeholder="è¼¸å…¥ï¼šå·¡é‚ / æ”¶é›† / å»ºé€  æˆ¿å±‹ / å‡ç´š / åœæ­¢è‡ªå‹•..." />
      <button onclick="sendCmd()">é€å‡º</button>
    </div>
  </div>

  <div class="floatingMini">
    <button class="miniBtn miniP" onclick="togglePanel()">â˜°</button>
    <button class="miniBtn miniA" onclick="toggleAI()">ğŸ¾</button>
    <button class="miniBtn miniS" onclick="manualSave()">ğŸ’¾</button>
  </div>

  <div class="toast" id="toast"></div>

  <audio id="audio">
</div>

<script>
const SAVE_KEY="AENO_V3_SAVE_FULL";
const VERSION=9;
const GRID_W=26, GRID_H=26;
const TILE=64;
const cv=document.getElementById("cv");
const ctx=cv.getContext("2d");
let W=0,H=0;

const statusText=document.getElementById("statusText");
const toast=document.getElementById("toast");

let state={
  version:VERSION,
  lastSeen:Date.now(),
  resources:{wood:80,stone:50,iron:10,food:120,coin:200,aeno:1.0},
  pop:{population:6,cap:10},
  territory:{radius:3},
  settings:{autoBuild:true,autoExpand:true},
  prices:{wood:2,stone:3,iron:8,food:2},
  stock:{ind:100,space:120,farm:90,holding:{ind:0,space:0,farm:0}},
  tech:{ind:0,def:0,robot:0},
  ads:{cooldown:0,listenedToday:0,totalToday:10},
  beast:{timer:420,active:false,lootCoin:0,shards:0},
  robot:{active:false,timer:0,stealTimer:43200,status:"å¾…å‘½",guard:false},
  map:{tiles:[],buildings:[]},
  ai:{x:12,y:12,mode:"patrol"},
  buildMode:null,selected:null
};

// ç™»éŒ„ç³»çµ± - å®Œå…¨ä¸å‹•
function doLogin(){
  const id=document.getElementById("loginId").value.trim();
  if(!id){alert("è«‹è¼¸å…¥ç©å®¶IDï¼");return;}
  document.getElementById("loginModal").style.display="none";
  document.getElementById("planetModal").style.display="flex";
}

// æ˜Ÿçƒé¸æ“‡
function startGameAfterSelect(){
  const p=document.getElementById("planetSelect").value;
  if(p==="mars"){state.resources.stone=80;state.resources.iron=40;}
  if(p==="blackhole"){state.resources.aeno=10;state.beast.shards=50;}
  document.getElementById("planetModal").style.display="none";
  initGame();
}

// ç¸æ½®è¦å‰‡ï¼šåŸç‰†å®Œå…¨ä¿®å¾© + æ»¿100ç¢ç‰‡å…ˆè§¸ç™¼
function spawnBeastWave(){
  let wallTotal=0;
  let wallBroken=false;
  for(const b of state.map.buildings){
    if(b.type==="wall"){
      wallTotal+=b.level;
      if(b.level<5) wallBroken=true;
    }
  }
  if(wallTotal<10 || wallBroken || state.beast.shards<100){
    addChatMsg("ai","ğŸ›¡ï¸ åŸç‰†æœªå®Œå…¨ä¿®å¾©/æœªæ»¿100ç¢ç‰‡ï¼Œç„¡æ³•ç™¼å‹•ç¸æ½®");
    return;
  }
  state.beast.active=true;
  addChatMsg("ai","âš”ï¸ ç¸æ½®çˆ†ç™¼ï¼");
  showToast("ç¸æ½®çˆ†ç™¼ï¼");
}

function resolveBeastWave(){
  let wall=0;
  for(const b of state.map.buildings){if(b.type==="wall")wall+=b.level;}
  const defPower=wall+state.tech.def*3;
  const atk=10+Math.random()*20;
  if(defPower>=atk){
    const loot=Math.floor(50+Math.random()*120);
    const shard=Math.floor(10+Math.random()*30);
    state.beast.lootCoin+=loot;state.beast.shards+=shard;
    addChatMsg("ai","âœ… æ“Šé€€ç¸æ½®ï¼é‡‘å¹£+"+loot+" ç¢ç‰‡+"+shard);
  }else{
    const stolen=Math.floor(state.resources.coin*0.08);
    state.resources.coin-=stolen;
    addChatMsg("ai","âŒ è¢«æ å¥ªé‡‘å¹£-"+stolen);
  }
  state.beast.active=false;
  state.beast.timer=9999999;
}

// æ©Ÿå™¨äººæ å¥ªï¼šéŠæˆ²10å¹´=ç¾å¯¦1æ—¥ï¼ŒéŠæˆ²åŠå¹´~1å¹´ä¸€æ¬¡
function robotSteal(){
  const ratio=state.robot.guard?0.05:0.20;
  const steal=(v)=>Math.floor(v*ratio);
  const sw=steal(state.resources.wood),ss=steal(state.resources.stone),si=steal(state.resources.iron),sf=steal(state.resources.food),sc=steal(state.resources.coin);
  state.resources.wood-=sw;state.resources.stone-=ss;state.resources.iron-=si;state.resources.food-=sf;state.resources.coin-=sc;
  addChatMsg("ai",`ğŸš¨ è¢«æ¶${Math.round(ratio*100)}%ï¼šæœ¨-${sw} é‡‘-${sc}`);
  showToast(`è¢«æ¶${Math.round(ratio*100)}%`);
  state.robot.stealTimer= 43200 + Math.floor(Math.random() * 43200);
}

// ä»¥ä¸‹æ‰€æœ‰åŸºç¤å‡½æ•¸å®Œå…¨æ²¿ç”¨å¯ç™»éŒ„ç‰ˆæœ¬ï¼Œä¸åšä»»ä½•ä¿®æ”¹
function genMap(){/* åŸç‰ˆä¸å‹• */}
function saveGame(){/* åŸç‰ˆä¸å‹• */}
function loadGame(){/* åŸç‰ˆä¸å‹• */}
function showToast(txt){/* åŸç‰ˆä¸å‹• */}
function switchTab(tab){/* åŸç‰ˆä¸å‹• */}
function togglePanel(){/* åŸç‰ˆä¸å‹• */}
function toggleAI(){/* åŸç‰ˆä¸å‹• */}
function makeDraggable(box){/* åŸç‰ˆä¸å‹• */}
function setBuildMode(t){/* åŸç‰ˆä¸å‹• */}
function addChatMsg(type,text){/* åŸç‰ˆä¸å‹• */}
function sendCmd(){/* åŸç‰ˆä¸å‹• */}
function parseCmd(t){/* åŸç‰ˆä¸å‹• */}
function toggleAutoBuild(){/* åŸç‰ˆä¸å‹• */}
function toggleAutoExpand(){/* åŸç‰ˆä¸å‹• */}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
let cam={x:0,y:0,scale:1};
function centerView(){cam.x=-(12*TILE)+W/2;cam.y=-(12*TILE)+H/2;}
function zoomIn(){cam.scale=clamp(cam.scale*1.15,0.6,2.4);}
function zoomOut(){cam.scale=clamp(cam.scale/1.15,0.6,2.4);}
// å…¶é¤˜æ‰€æœ‰åŸºç¤æ¸²æŸ“ã€æ¨¡æ“¬ã€å»ºé€ ã€å‡ç´šå‡½æ•¸å®Œå…¨æ²¿ç”¨åŸç‰ˆå¯ç™»éŒ„ä»£ç¢¼

// ä¸»å¾ªç’°èˆ‡åˆå§‹åŒ–å®Œå…¨ä¸å‹•ï¼Œä¿è­‰ç™»éŒ„æ­£å¸¸
window.addEventListener('load', function(){});
</script>
</body>
</html>
