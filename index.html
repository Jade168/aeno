<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>AENO - é‡å­æ˜Ÿçƒæ–‡æ˜æ¨¡æ“¬</title>
  <link rel="manifest" href="manifest.json" />
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}
html, body {
  margin: 0;
  padding: 0;
  background: #0b1020;
  overflow: hidden;
  font-family: Arial, "Microsoft JhengHei", "PingFang HK", sans-serif;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
}

/* éŠæˆ²ç•«å¸ƒ - é»˜èªéš±è—ï¼Œé€²å…¥æ˜Ÿçƒå…ˆé¡¯ç¤º */
#game {
  display: none;
  width: 100vw;
  height: 100vh;
  background: linear-gradient(#091224, #081018);
}

/* é ‚éƒ¨HUD - é»˜èªéš±è— */
#hudTop {
  position: fixed;
  top: 6px;
  left: 6px;
  right: 6px;
  display: none;
  gap: 6px;
  justify-content: space-between;
  z-index: 50;
  pointer-events: none;
}
.hudBox {
  pointer-events: auto;
  background: rgba(0,0,0,0.75);
  border: 1px solid rgba(255,255,255,0.15);
  color: #fff;
  padding: 8px 12px;
  border-radius: 12px;
  font-size: 12px;
  line-height: 1.3em;
  backdrop-filter: blur(8px);
  max-width: 48vw;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
}
.hudRow {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}
.pill {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  padding: 3px 8px;
  border-radius: 999px;
  font-size: 11px;
  white-space: nowrap;
}

/* æ§åˆ¶ä¸­å¿ƒ - é»˜èªéš±è— */
#panel {
  position: fixed;
  right: 8px;
  bottom: 80px;
  width: min(340px, 85vw);
  max-height: 30vh;
  background: rgba(10,14,20,0.9);
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 16px;
  color: #fff;
  z-index: 100;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  backdrop-filter: blur(12px);
  overflow: hidden;
  display: none;
  flex-direction: column;
  touch-action: none;
}
#panelHeader {
  padding: 10px 12px;
  font-size: 13px;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255,255,255,0.06);
  cursor: grab;
}
#panelBody {
  padding: 10px 12px;
  overflow: auto;
  font-size: 12px;
}
.btnRow {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-top: 8px;
}
button {
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.18);
  color: #fff;
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  touch-action: manipulation;
}
button:active { transform: scale(0.96); background: rgba(255,255,255,0.15); }
button.active { background: #2563eb; }
#togglePanelBtn {
  position: fixed;
  right: 8px;
  bottom: 12px;
  z-index: 200;
  border-radius: 999px;
  padding: 12px 16px;
  font-size: 12px;
  font-weight: bold;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(10px);
  color: #fff;
  display: none;
}

/* æ˜Ÿçƒé¸æ“‡ç•Œé¢ */
#planetSelect {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  z-index: 999;
  display: none;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  color: #fff;
  padding: 60px 20px 20px;
  backdrop-filter: blur(15px);
  overflow-y: auto;
}
.planetCard {
  width: min(380px, 92vw);
  padding: 14px;
  border-radius: 16px;
  border: 1px solid rgba(255,255,255,0.16);
  background: rgba(255,255,255,0.06);
  margin-bottom: 12px;
  transition: all 0.2s;
}
.planetTitle {
  font-size: 15px;
  font-weight: bold;
  margin-bottom: 6px;
}
.planetDesc {
  font-size: 12px;
  opacity: 0.9;
  margin-bottom: 10px;
}

/* è¨»å†Š+ç™»å…¥ç•Œé¢ */
#authOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.95);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #fff;
  padding: 20px;
}
.authBox {
  width: min(360px, 90vw);
  background: rgba(20,25,40,0.9);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 16px;
  padding: 28px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.5);
}
.authBox h2 {
  text-align: center;
  margin-bottom: 24px;
  font-size: 20px;
  color: #4a6cf7;
}
.authTab {
  display: flex;
  gap: 2px;
  margin-bottom: 20px;
  border-radius: 10px;
  overflow: hidden;
  background: rgba(255,255,255,0.05);
}
.authTabBtn {
  flex: 1;
  padding: 10px;
  border: none;
  background: transparent;
  color: #fff;
  font-size: 14px;
  cursor: pointer;
  border-radius: 0;
}
.authTabBtn.active {
  background: #4a6cf7;
  font-weight: bold;
}
.authForm {
  display: none;
  flex-direction: column;
  gap: 14px;
}
.authForm.active {
  display: flex;
}
.authForm input {
  width: 100%;
  box-sizing: border-box;
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(0,0,0,0.4);
  color: #fff;
  font-size: 14px;
}
.authForm button {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  background: #4a6cf7;
  color: #fff;
  border: none;
  font-size: 15px;
  font-weight: bold;
  margin-top: 8px;
}
.devNote {
  text-align: center;
  margin-top: 20px;
  font-size: 11px;
  opacity: 0.7;
}
.authTip {
  font-size: 11px;
  opacity: 0.8;
  text-align: center;
}

/* AIåŠ©æ‰‹å°è©±æ¡† */
#assistantChat {
  position: fixed;
  left: 8px;
  bottom: 80px;
  width: min(340px, 85vw);
  max-height: 40vh;
  background: rgba(10,14,20,0.9);
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 16px;
  color: #fff;
  z-index: 100;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  backdrop-filter: blur(12px);
  overflow: hidden;
  display: none;
  flex-direction: column;
}
#assistantChatHeader {
  padding: 10px 12px;
  font-size: 13px;
  font-weight: bold;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255,255,255,0.06);
}
#assistantChatBody {
  padding: 10px 12px;
  overflow: auto;
  font-size: 12px;
  flex: 1;
}
#assistantInputBox {
  padding: 8px 12px;
  border-top: 1px solid rgba(255,255,255,0.1);
  display: flex;
  gap: 8px;
}
#assistantInput {
  flex: 1;
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(0,0,0,0.4);
  color: #fff;
  font-size: 12px;
}
#sendAssistant {
  padding: 8px 12px;
  border-radius: 8px;
  background: #4a6cf7;
  color: #fff;
  border: none;
  font-size: 12px;
  font-weight: bold;
}
#toggleAssistantBtn {
  position: fixed;
  left: 8px;
  bottom: 12px;
  z-index: 200;
  border-radius: 999px;
  padding: 12px 16px;
  font-size: 12px;
  font-weight: bold;
  background: rgba(0,0,0,0.7);
  border: 1px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(10px);
  color: #fff;
  display: none;
}

/* é€šç”¨æ¨£å¼ */
.muted { opacity: 0.85; font-size: 11px; }
.ok { color: #a8ffb8; }
.warning { color: #ffd966; }
.danger { color: #ff9aa2; }
  </style>
</head>

<body>
<!-- è¨»å†Š+ç™»å…¥ç•Œé¢ -->
<div id="authOverlay">
  <div class="authBox">
    <h2>ğŸ” AENO æ˜Ÿçƒæ–‡æ˜</h2>
    <div class="authTab">
      <button class="authTabBtn active" data-tab="register">é¦–æ¬¡è¨»å†Š</button>
      <button class="authTabBtn" data-tab="login">å·²æœ‰å¸³è™Ÿç™»å…¥</button>
    </div>

    <div class="authForm active" id="registerForm">
      <input type="text" id="registerID" placeholder="è«‹è¨­å®šä½ çš„å¸³è™ŸID" autocomplete="off" />
      <input type="password" id="devKeyInput" placeholder="è«‹è¼¸å…¥é–‹ç™¼è€…å°ˆå±¬å®‰å…¨ç¢¼" autocomplete="off" style="display:none;" />
      <input type="password" id="registerPwd" placeholder="è«‹è¨­å®šå¯†ç¢¼ï¼ˆè‡³å°‘6ä½ï¼‰" autocomplete="new-password" />
      <input type="password" id="registerPwdConfirm" placeholder="è«‹å†æ¬¡ç¢ºèªå¯†ç¢¼" autocomplete="new-password" />
      <button id="registerBtn">å®Œæˆè¨»å†Š</button>
      <div class="authTip">æ¯å€‹å¸³è™ŸIDå”¯ä¸€ï¼Œè¨»å†Šå¾Œä¸å¯ä¿®æ”¹ï¼Œè«‹å¦¥å–„ä¿ç®¡å¯†ç¢¼</div>
    </div>

    <div class="authForm" id="loginForm">
      <input type="text" id="loginID" placeholder="è«‹è¼¸å…¥ä½ çš„å¸³è™ŸID" autocomplete="off" />
      <input type="password" id="loginPwd" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" autocomplete="current-password" />
      <button id="loginBtn">ç™»å…¥éŠæˆ²</button>
      <div class="authTip">æœªè¨»å†Šè«‹å…ˆé»æ“Šã€Œé¦–æ¬¡è¨»å†Šã€</div>
    </div>

    <div class="devNote">é–‹ç™¼è€…ï¼šé˜¿å‹’é “ | æœªä¾†å°‡é–‹æ”¾æŒ‡ç´‹èªè­‰</div>
  </div>
</div>

<!-- éŠæˆ²ç•«å¸ƒ -->
<canvas id="game"></canvas>

<!-- é ‚éƒ¨HUD -->
<div id="hudTop">
  <div class="hudBox" id="hudLeft">
    <div class="hudRow">
      <span class="pill">ğŸŒ <span id="planetName">?</span></span>
      <span class="pill">â±ï¸ <span id="gameYear">0</span> å¹´</span>
      <span class="pill">ğŸ‘¥ <span id="popCount">0</span></span>
    </div>
    <div class="hudRow" style="margin-top:4px;">
      <span class="pill">ğŸª™ é‡‘å¹£: <span id="coins">0</span></span>
      <span class="pill">ğŸŸ¡ AENO: <span id="aeno">0.0000</span></span>
    </div>
  </div>
  <div class="hudBox" id="hudRight">
    <div class="hudRow">
      <span class="pill">ğŸªµ æœ¨: <span id="wood">0</span></span>
      <span class="pill">ğŸª¨ çŸ³: <span id="stone">0</span></span>
      <span class="pill">â›ï¸ éµ: <span id="iron">0</span></span>
      <span class="pill">ğŸŒ¾ ç³§: <span id="food">0</span></span>
    </div>
    <div class="hudRow" style="margin-top:4px;">
      <span class="pill">âš™ï¸ å·¥å» : <span id="factoryCount">0</span></span>
      <span class="pill">ğŸ¤– æ©Ÿå™¨äºº: <span id="robotCount">0</span></span>
    </div>
  </div>
</div>

<!-- æŒ‰éˆ•å€ -->
<button id="toggleAssistantBtn">ğŸ¤– AIåŠ©æ‰‹</button>
<button id="togglePanelBtn">ğŸ“Œ æ§åˆ¶ä¸­å¿ƒ</button>

<!-- AIåŠ©æ‰‹å°è©±æ¡† -->
<div id="assistantChat">
  <div id="assistantChatHeader">
    <span>ğŸ¤– AENO AIåŠ©æ‰‹</span>
    <button id="closeChat">é—œé–‰</button>
  </div>
  <div id="assistantChatBody"></div>
  <div id="assistantInputBox">
    <input type="text" id="assistantInput" placeholder="è¼¸å…¥æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼šä¿®å¾©ã€å»ºé€ ã€å‡ç´š..." />
    <button id="sendAssistant">ç™¼é€</button>
  </div>
</div>

<!-- æ§åˆ¶ä¸­å¿ƒé¢æ¿ -->
<div id="panel">
  <div id="panelHeader">
    <span>ğŸ“Œ æ§åˆ¶ä¸­å¿ƒ</span>
    <span>
      <button id="btnSave">ä¿å­˜</button>
      <button id="btnHidePanel">æ”¶èµ·</button>
    </span>
  </div>
  <div id="panelBody">
    <div><b>æç¤ºï¼š</b>é»é ˜åœŸç©ºåœ°å¯ä»¥å»ºç¯‰æˆ¿å±‹</div>
    <div class="muted">Zoom: é›™æŒ‡ç¸®æ”¾ / æ»¾è¼ª | æ‹–åœ°åœ–ï¼šä¸€æŒ‡æ‹–å‹•</div>

    <div class="btnRow">
      <button id="btnBuildMode" class="active">ğŸ—ï¸ å»ºç¯‰æ¨¡å¼</button>
      <button id="btnUpgradeMode">â¬†ï¸ å‡ç´šæ¨¡å¼</button>
      <button id="btnAuto">ğŸ¤– è‡ªå‹•å»ºé€ : <span id="autoState">ON</span></button>
    </div>

    <div class="btnRow">
      <button id="btnAdSong">ğŸµ æ’­æ”¾å»£å‘Šæ­Œ</button>
      <button id="btnLoopSong">ğŸ” Loop: <span id="loopState">ON</span></button>
    </div>

    <div class="btnRow">
      <button id="btnRobotSend">ğŸš€ æ´¾æ©Ÿå™¨äººæ¢ç´¢</button>
      <button id="btnExchange">ğŸ¦ äº¤æ˜“æ‰€</button>
      <button id="btnTech">ğŸ§¬ ç§‘æŠ€æ¨¹</button>
    </div>

    <div style="margin-top:12px;">
      <b>AIåŠ©æ‰‹å„ªå…ˆé †åºï¼š</b>
      <div class="btnRow">
        <button class="prioBtn" data-prio="house">ğŸ  æˆ¿å±‹</button>
        <button class="prioBtn" data-prio="lumber">ğŸªµ ä¼æœ¨</button>
        <button class="prioBtn" data-prio="quarry">ğŸª¨ æ¡çŸ³</button>
        <button class="prioBtn" data-prio="mine">â›ï¸ ç¤¦å ´</button>
        <button class="prioBtn" data-prio="farm">ğŸŒ¾ è¾²ç”°</button>
      </div>
      <div class="muted">AIæœƒåš´æ ¼éµå®ˆå„ªå…ˆç´šï¼Œè‡ªå‹•å¹³è¡¡è³‡æº</div>
    </div>

    <div style="margin-top:12px;">
      <b>ç³»çµ±è¨Šæ¯ï¼š</b>
      <div id="logBox" style="margin-top:6px; max-height: 10vh; overflow:auto; font-size: 11px; opacity:0.92;"></div>
    </div>
  </div>
</div>

<!-- æ˜Ÿçƒé¸æ“‡ç•Œé¢ -->
<div id="planetSelect">
  <div style="font-size:20px; font-weight:bold; margin-bottom:15px;">ğŸŒŒ é¸æ“‡ä½ çš„æ˜Ÿçƒ</div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŸ© Planet-01 ç¶ åŸæ˜Ÿ</div>
    <div class="planetDesc">æ£®æ—èŒ‚å¯†ï¼Œæœ¨æç”¢å‡ºé«˜ï¼Œé©åˆæ–°æ‰‹å…¥é–€</div>
    <button class="planetBtn" data-planet="Planet-01" data-seed="forest">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŸ« Planet-02 å²©çŸ³æ˜Ÿ</div>
    <div class="planetDesc">çŸ³ç¤¦è±å¯Œï¼Œå»ºç¯‰å‡ç´šæ›´å¿«ï¼Œåœ°å½¢å´å¶‡</div>
    <button class="planetBtn" data-planet="Planet-02" data-seed="rock">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">âš™ï¸ Planet-03 å·¥æ¥­æ˜Ÿ</div>
    <div class="planetDesc">éµç¤¦å„²é‡é«˜ï¼Œé©åˆç™¼å±•å·¥å» èˆ‡æ©Ÿå™¨äººæ–‡æ˜</div>
    <button class="planetBtn" data-planet="Planet-03" data-seed="iron">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¾ Planet-04 è¾²ç‰§æ˜Ÿ</div>
    <div class="planetDesc">åœŸåœ°è‚¥æ²ƒï¼Œç³§é£Ÿç”¢å‡ºé«˜ï¼Œäººå£æˆé•·é€Ÿåº¦å¿«</div>
    <button class="planetBtn" data-planet="Planet-04" data-seed="farm">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <!-- å…¶é¤˜16å€‹æ˜Ÿçƒï¼Œå°æ‡‰ç­–åŠƒå¤§ç¶±20å€‹æ˜Ÿçƒ -->
  <div class="planetCard">
    <div class="planetTitle">ğŸŒŠ Planet-05 æ²³æµæ˜Ÿ</div>
    <div class="planetDesc">æ°´ç³»ç™¼é”ï¼Œç³§é£Ÿèˆ‡æœ¨æå‡è¡¡ï¼Œé‡ç¸å¼·åº¦ä¸­ç­‰</div>
    <button class="planetBtn" data-planet="Planet-05" data-seed="river">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸœï¸ Planet-06 è’æ¼ æ˜Ÿ</div>
    <div class="planetDesc">è³‡æºç¨€å°‘ï¼Œä½†éµç¤¦èˆ‡ç¨€æœ‰ç¤¦ç”¢è±å¯Œï¼Œé©åˆé«˜éšç©å®¶</div>
    <button class="planetBtn" data-planet="Planet-06" data-seed="desert">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ² Planet-07 é‡è‘‰æ˜Ÿ</div>
    <div class="planetDesc">å¯’å¸¶æ£®æ—ï¼Œæœ¨æç”¢å‡ºæ¥µé«˜ï¼ŒçŸ³ç¤¦ä¸­ç­‰</div>
    <button class="planetBtn" data-planet="Planet-07" data-seed="forest">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">â›°ï¸ Planet-08 å±±å¶½æ˜Ÿ</div>
    <div class="planetDesc">é«˜å±±åœ°å½¢ï¼ŒçŸ³ç¤¦èˆ‡éµç¤¦è±å¯Œï¼Œå»ºç¯‰é›£åº¦ç¨é«˜</div>
    <button class="planetBtn" data-planet="Planet-08" data-seed="mountain">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¾ Planet-09 æ²ƒåœŸæ˜Ÿ</div>
    <div class="planetDesc">é»‘åœŸå¹³åŸï¼Œç³§é£Ÿç”¢å‡ºç¿»å€ï¼Œäººå£æˆé•·é€Ÿåº¦æ¥µå¿«</div>
    <button class="planetBtn" data-planet="Planet-09" data-seed="farm">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">âš™ï¸ Planet-10 é‡å·¥æ˜Ÿ</div>
    <div class="planetDesc">å·¥æ¥­ç™¼é”ï¼Œå·¥å» æ•ˆç‡æå‡ï¼Œé©åˆæ©Ÿå™¨äººèˆ‡ç§‘æŠ€ç™¼å±•</div>
    <button class="planetBtn" data-planet="Planet-10" data-seed="iron">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¿ Planet-11 é›¨æ—æ˜Ÿ</div>
    <div class="planetDesc">ç†±å¸¶é›¨æ—ï¼Œæœ¨æèˆ‡ç³§é£Ÿè±å¯Œï¼Œé‡ç¸å¼·åº¦è¼ƒé«˜</div>
    <button class="planetBtn" data-planet="Planet-11" data-seed="forest">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸª¨ Planet-12 èŠ±å´—æ˜Ÿ</div>
    <div class="planetDesc">å …ç¡¬å²©çŸ³åœ°å½¢ï¼ŒçŸ³ç¤¦ç”¢å‡ºç¿»å€ï¼Œå»ºç¯‰é˜²ç¦¦åŠ›æå‡</div>
    <button class="planetBtn" data-planet="Planet-12" data-seed="rock">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">â›ï¸ Planet-13 é‡‘å±¬æ˜Ÿ</div>
    <div class="planetDesc">é‡‘å±¬ç¤¦è„ˆå¯†é›†ï¼Œéµç¤¦ç”¢å‡ºç¿»å€ï¼Œé©åˆå·¥æ¥­ç™¼å±•</div>
    <button class="planetBtn" data-planet="Planet-13" data-seed="iron">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¾ Planet-14 ç‰§å ´æ˜Ÿ</div>
    <div class="planetDesc">å»£é—Šè‰åŸï¼Œç³§é£Ÿèˆ‡äººå£å‡è¡¡ï¼Œé©åˆç©©å®šç™¼å±•</div>
    <button class="planetBtn" data-planet="Planet-14" data-seed="farm">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒŠ Planet-15 ç¾¤å³¶æ˜Ÿ</div>
    <div class="planetDesc">æµ·æ´‹ç¾¤å³¶ï¼Œè³‡æºå‡è¡¡ï¼Œè²¿æ˜“èˆ‡äº¤æ˜“æ‰€æ”¶ç›Šæå‡</div>
    <button class="planetBtn" data-planet="Planet-15" data-seed="river">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸœï¸ Planet-16 é¹½æ¼ æ˜Ÿ</div>
    <div class="planetDesc">è’æ¼ é¹½åœ°ï¼Œè³‡æºç¨€å°‘ï¼Œä½†ç¨€æœ‰æ‰è½æ¦‚ç‡æå‡</div>
    <button class="planetBtn" data-planet="Planet-16" data-seed="desert">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ² Planet-17 å¯’å¸¶æ˜Ÿ</div>
    <div class="planetDesc">å¯’å¸¶å‡åœŸï¼Œæœ¨æç”¢å‡ºé«˜ï¼Œé‡ç¸å¼·åº¦é«˜ï¼Œçå‹µè±åš</div>
    <button class="planetBtn" data-planet="Planet-17" data-seed="forest">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">â›°ï¸ Planet-18 é«˜åŸæ˜Ÿ</div>
    <div class="planetDesc">é«˜åŸåœ°å½¢ï¼ŒçŸ³ç¤¦èˆ‡éµç¤¦è±å¯Œï¼Œå»ºç¯‰æˆæœ¬ç¨é«˜</div>
    <button class="planetBtn" data-planet="Planet-18" data-seed="mountain">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">âš™ï¸ Planet-19 ç§‘æŠ€æ˜Ÿ</div>
    <div class="planetDesc">ç§‘æŠ€ç™¼é”ï¼Œç ”ç©¶æ‰€æ•ˆç‡æå‡ï¼Œç§‘æŠ€è§£é–æˆæœ¬é™ä½</div>
    <button class="planetBtn" data-planet="Planet-19" data-seed="iron">é€²å…¥æ˜Ÿçƒ</button>
  </div>
  <div class="planetCard">
    <div class="planetTitle">ğŸŒ¾ Planet-20 ç”Ÿæ…‹æ˜Ÿ</div>
    <div class="planetDesc">ç”Ÿæ…‹å®Œç¾ï¼Œæ‰€æœ‰è³‡æºå‡è¡¡ç”¢å‡ºï¼Œé©åˆå…¨æ–¹é¢ç™¼å±•</div>
    <button class="planetBtn" data-planet="Planet-20" data-seed="farm">é€²å…¥æ˜Ÿçƒ</button>
  </div>

  <!-- é–‹ç™¼è€…å°ˆå±¬é»‘æ´å­¤å³¶ -->
  <div class="planetCard" id="devBlackHoleCard" style="border-color: rgba(255,255,255,0.3); background: rgba(80,0,120,0.22); display:none;">
    <div class="planetTitle">ğŸ•³ï¸ é»‘æ´å­¤å³¶ï¼ˆé–‹ç™¼è€…å°ˆå±¬ï¼‰</div>
    <div class="planetDesc">ç‰¹æ®Šæ˜ŸåŸŸï¼Œå…¨æ˜Ÿçƒæ•¸æ“šç®¡ç†ã€ç§»æ°‘ç³»çµ±ã€ç”³è«‹åˆ¶åº¦ç”±æ­¤é–‹æ”¾</div>
    <button class="planetBtn" data-planet="BlackHole-Island" data-seed="blackhole">é€²å…¥é–‹ç™¼è€…å¾Œå°</button>
  </div>

  <div class="muted" style="margin-top:15px; text-align:center;">
    âš ï¸ éŠæˆ²æœƒè‡ªå‹•ä¿å­˜ï¼Œæ›´æ–°ç‰ˆæœ¬å¾Œä»å¯ä¿ç•™é€²åº¦<br/>
    éŸ³æ¨‚éœ€æ‰‹å‹•é»æ“Šæ’­æ”¾ï¼ˆæ‰‹æ©Ÿç€è¦½å™¨é™åˆ¶ï¼‰
  </div>
</div>

<!-- éŠæˆ²æ ¸å¿ƒJSå¼•å…¥ï¼Œé †åºä¸å¯äº‚ -->
<script src="ai-assistant.js"></script>
<script src="game.js"></script>

<script>
// ==================== å…¨å±€é…ç½®ï¼ˆå›ºå®šä¸è®Šï¼‰ ====================
const AENO_CONFIG = {
  ACCOUNT_DB_KEY: "AENO_ACCOUNT_DATABASE_V4",
  CURRENT_ACCOUNT_KEY: "AENO_CURRENT_LOGIN",
  DEV_ACCOUNT_ID: "é˜¿å‹’é “",
  DEV_KEY_HASH: "YWxldG9uX2Flbm9fMjAyNA==", // å®‰å…¨ç¢¼ï¼šaleton_aeno_2024
};

// ==================== å…¨å±€ç‹€æ…‹ ====================
window.AENO_GLOBAL = {
  auth: {
    currentPlayer: null,
    isLoggedIn: false,
    isDeveloper: false,
  },
  currentPlanet: {
    planetId: null,
    seedType: null,
    isLoaded: false,
  },
  elements: {}, // é é¢å…ƒç´ ç·©å­˜ï¼Œé¿å…é‡è¤‡æŸ¥æ‰¾
};

// ==================== å·¥å…·å‡½æ•¸ ====================
// åŠ å¯†å‡½æ•¸ï¼ˆå›ºå®šä¸è®Šï¼‰
function encryptContent(content) {
  return btoa(encodeURIComponent(content.trim().toLowerCase()));
}
function checkDevKey(inputKey) {
  return encryptContent(inputKey) === AENO_CONFIG.DEV_KEY_HASH;
}
function encryptPassword(pwd) {
  return encryptContent(pwd + "_" + AENO_CONFIG.DEV_ACCOUNT_ID);
}
// ç³»çµ±æ—¥èªŒï¼ˆèˆ‡game.jsã€ai-assistant.jså…±ç”¨ï¼‰
window.log = function log(msg, type="") {
  console.log(`[AENO] ${msg}`);
  const logBox = window.AENO_GLOBAL.elements.logBox;
  if (!logBox) return;
  const div = document.createElement("div");
  div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  if (type === "ok") div.style.color = "#a8ffb8";
  if (type === "warning") div.style.color = "#ffd966";
  if (type === "danger") div.style.color = "#ff9aa2";
  logBox.prepend(div);
  while (logBox.children.length > 50) logBox.removeChild(logBox.lastChild);
};

// ==================== å¸³è™Ÿç³»çµ± ====================
function getAccountDB() {
  try {
    const raw = localStorage.getItem(AENO_CONFIG.ACCOUNT_DB_KEY);
    return raw ? JSON.parse(raw) : {};
  } catch (e) {
    console.error("è®€å–å¸³è™Ÿæ•¸æ“šåº«å¤±æ•—", e);
    return {};
  }
}
function saveAccountDB(db) {
  try {
    localStorage.setItem(AENO_CONFIG.ACCOUNT_DB_KEY, JSON.stringify(db));
  } catch (e) {
    console.error("ä¿å­˜å¸³è™Ÿæ•¸æ“šåº«å¤±æ•—", e);
    alert("âŒ ä¿å­˜å¸³è™Ÿæ•¸æ“šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨å­˜å„²æ¬Šé™");
  }
}

// è¨»å†Šå¸³è™Ÿ
function registerAccount(username, inputDevKey, password, confirmPwd) {
  try {
    const db = getAccountDB();
    username = username.trim();

    if (!username || username.length < 2) {
      alert("âŒ å¸³è™Ÿé•·åº¦è‡³å°‘2ä½");
      return false;
    }
    if (!password || password.length < 6) {
      alert("âŒ å¯†ç¢¼é•·åº¦è‡³å°‘6ä½ï¼Œè«‹è¨­å®šæ›´å®‰å…¨çš„å¯†ç¢¼");
      return false;
    }
    if (password !== confirmPwd) {
      alert("âŒ å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´");
      return false;
    }
    if (db[username]) {
      alert("âŒ æ­¤å¸³è™ŸIDå·²è¢«è¨»å†Šï¼Œè«‹æ›´æ›å…¶ä»–ID");
      return false;
    }

    // é–‹ç™¼è€…å¸³è™Ÿæ ¡é©—
    const isDevAccount = username === AENO_CONFIG.DEV_ACCOUNT_ID;
    if (isDevAccount) {
      if (!inputDevKey || inputDevKey.trim() === "") {
        alert("âŒ é–‹ç™¼è€…å¸³è™Ÿå¿…é ˆè¼¸å…¥å°ˆå±¬å®‰å…¨ç¢¼");
        return false;
      }
      if (!checkDevKey(inputDevKey)) {
        alert("âŒ é–‹ç™¼è€…å®‰å…¨ç¢¼éŒ¯èª¤ï¼Œç„¡æ¬Šè¨»å†Šæ­¤å¸³è™Ÿ");
        return false;
      }
    }

    // å„²å­˜å¸³è™Ÿ
    db[username] = {
      username: username,
      password: encryptPassword(password),
      registerTime: Date.now(),
      lastLoginTime: null,
      fingerprintBind: false,
      isDeveloper: isDevAccount,
    };
    saveAccountDB(db);

    alert(`âœ… è¨»å†ŠæˆåŠŸï¼${isDevAccount ? "é–‹ç™¼è€…å¸³è™Ÿ" : "å¸³è™Ÿ"}å·²å‰µå»ºï¼Œè«‹ä½¿ç”¨å¸³è™Ÿç™»å…¥`);
    switchAuthTab("login");
    window.AENO_GLOBAL.elements.loginID.value = username;
    return true;
  } catch (e) {
    console.error("è¨»å†Šå¤±æ•—", e);
    alert("âŒ è¨»å†Šå¤±æ•—ï¼Œè«‹é‡è©¦");
    return false;
  }
}

// ç™»å…¥å¸³è™Ÿ
function loginAccount(username, password) {
  try {
    const db = getAccountDB();
    username = username.trim();

    if (!username || !password) {
      alert("âŒ è«‹è¼¸å…¥å®Œæ•´çš„å¸³è™Ÿå’Œå¯†ç¢¼");
      return false;
    }
    const account = db[username];
    if (!account) {
      alert("âŒ æ­¤å¸³è™Ÿæœªè¨»å†Šï¼Œè«‹å…ˆå®Œæˆè¨»å†Š");
      return false;
    }

    // å¯†ç¢¼æ ¡é©—
    const encryptedInput = encryptPassword(password);
    if (account.password !== encryptedInput) {
      alert("âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥");
      return false;
    }

    // ç™»å…¥æˆåŠŸ
    account.lastLoginTime = Date.now();
    saveAccountDB(db);
    localStorage.setItem(AENO_CONFIG.CURRENT_ACCOUNT_KEY, username);

    // æ›´æ–°å…¨å±€ç‹€æ…‹
    window.AENO_GLOBAL.auth = {
      currentPlayer: username,
      isLoggedIn: true,
      isDeveloper: account.isDeveloper || false,
    };

    // é–‹ç™¼è€…æ¬Šé™è§£é–
    if (window.AENO_GLOBAL.auth.isDeveloper) {
      window.AENO_GLOBAL.elements.devBlackHoleCard.style.display = "block";
      log("ğŸ” é–‹ç™¼è€…å¸³è™Ÿç™»å…¥ï¼Œé»‘æ´å­¤å³¶å·²è§£é–", "ok");
    }

    // éš±è—ç™»å…¥æ¡†ï¼Œé¡¯ç¤ºæ˜Ÿçƒé¸æ“‡
    window.AENO_GLOBAL.elements.authOverlay.style.display = "none";
    window.AENO_GLOBAL.elements.planetSelect.style.display = "flex";

    alert(`âœ… ç™»å…¥æˆåŠŸï¼æ­¡è¿å›ä¾†ï¼Œ${username}`);
    console.log("ç™»å…¥æˆåŠŸï¼Œå…¨å±€ç‹€æ…‹ï¼š", window.AENO_GLOBAL.auth);
    return true;
  } catch (e) {
    console.error("ç™»å…¥å¤±æ•—", e);
    alert("âŒ ç™»å…¥å¤±æ•—ï¼Œè«‹é‡è©¦");
    return false;
  }
}

// ==================== ã€æ ¸å¿ƒå°æ¥ã€‘é€²å…¥æ˜Ÿçƒé‚è¼¯ï¼Œèˆ‡game.jså®Œå…¨åŒ¹é… ====================
function enterPlanet(planetId, seedType) {
  try {
    console.log("é–‹å§‹é€²å…¥æ˜Ÿçƒï¼š", planetId, seedType);
    if (!window.AENO_GLOBAL.auth.isLoggedIn) {
      alert("âŒ è«‹å…ˆç™»å…¥å¸³è™Ÿ");
      return;
    }

    // æ›´æ–°å…¨å±€ç‹€æ…‹
    window.AENO_GLOBAL.currentPlanet = {
      planetId: planetId,
      seedType: seedType,
      isLoaded: true,
    };

    // æ›´æ–°é é¢é¡¯ç¤º
    window.AENO_GLOBAL.elements.planetName.textContent = planetId;
    window.AENO_GLOBAL.elements.planetSelect.style.display = "none";
    window.AENO_GLOBAL.elements.gameCanvas.style.display = "block";
    window.AENO_GLOBAL.elements.hudTop.style.display = "flex";
    window.AENO_GLOBAL.elements.togglePanelBtn.style.display = "block";
    window.AENO_GLOBAL.elements.toggleAssistantBtn.style.display = "block";
    window.AENO_GLOBAL.elements.panel.style.display = "flex";

    // åˆå§‹åŒ–ç•«å¸ƒå¤§å°
    resizeCanvas();

    // ã€é—œéµã€‘èª¿ç”¨game.jsåˆå§‹åŒ–å‡½æ•¸ï¼Œå®Œå…¨å°æ¥
    try {
      if (window.Game_Init) {
        window.Game_Init(planetId, seedType);
        console.log("å·²èª¿ç”¨game.jsçš„Game_Initå‡½æ•¸ï¼ŒéŠæˆ²æ ¸å¿ƒå·²å•Ÿå‹•");
      } else {
        console.log("game.jsæœªæä¾›Game_Initå‡½æ•¸ï¼Œå·²é¡¯ç¤ºåŸºç¤éŠæˆ²ç•«å¸ƒ");
        log("âš ï¸ éŠæˆ²æ ¸å¿ƒæ¨¡å¡ŠåŠ è¼‰ç•°å¸¸ï¼Œä½†åŸºç¤ç•Œé¢å·²æ­£å¸¸é¡¯ç¤º", "warning");
      }
    } catch (gameError) {
      console.error("game.jsåŸ·è¡Œå ±éŒ¯ï¼Œä½†å·²æˆåŠŸé€²å…¥éŠæˆ²ç•«é¢", gameError);
      log("âš ï¸ éŠæˆ²æ ¸å¿ƒæ¨¡å¡ŠåŠ è¼‰ç•°å¸¸ï¼Œè«‹æª¢æŸ¥game.jsä»£ç¢¼", "warning");
    }

    log(`ğŸŒ æˆåŠŸé€²å…¥æ˜Ÿçƒï¼š${planetId}`, "ok");
    console.log("é€²å…¥æ˜ŸçƒæˆåŠŸï¼");
  } catch (e) {
    console.error("é€²å…¥æ˜Ÿçƒå¤±æ•—", e);
    alert("âŒ é€²å…¥æ˜Ÿçƒå¤±æ•—ï¼Œè«‹é‡è©¦");
  }
}

// ==================== ç•«å¸ƒå¤§å°èª¿æ•´ ====================
window.resizeCanvas = function resizeCanvas() {
  const canvas = window.AENO_GLOBAL.elements.gameCanvas;
  if (!canvas) return;
  const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
  canvas.width = Math.floor(window.innerWidth * dpr);
  canvas.height = Math.floor(window.innerHeight * dpr);
  canvas.style.width = window.innerWidth + "px";
  canvas.style.height = window.innerHeight + "px";
  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  ctx.imageSmoothingEnabled = true;
}

// ==================== é é¢åˆ‡æ› ====================
function switchAuthTab(tab) {
  document.querySelectorAll(".authTabBtn").forEach(btn => btn.classList.remove("active"));
  document.querySelectorAll(".authForm").forEach(form => form.classList.remove("active"));
  document.querySelector(`.authTabBtn[data-tab="${tab}"]`).classList.add("active");
  document.getElementById(`${tab}Form`).classList.add("active");
  // é–‹ç™¼è€…å¸³è™Ÿé¡¯ç¤ºå®‰å…¨ç¢¼è¼¸å…¥æ¡†
  if (tab === "register") {
    const registerID = document.getElementById("registerID");
    const devKeyInput = document.getElementById("devKeyInput");
    registerID.addEventListener("input", () => {
      if (registerID.value.trim() === AENO_CONFIG.DEV_ACCOUNT_ID) {
        devKeyInput.style.display = "block";
      } else {
        devKeyInput.style.display = "none";
      }
    });
  }
}

// ==================== é é¢åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ– ====================
window.addEventListener("DOMContentLoaded", () => {
  console.log("é é¢åŠ è¼‰å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–AENOç³»çµ±");

  // ã€æ ¸å¿ƒã€‘é é¢ä¸€åŠ è¼‰å°±ç·©å­˜æ‰€æœ‰å…ƒç´ ï¼Œé¿å…å¾ŒçºŒæ‰¾ä¸åˆ°
  window.AENO_GLOBAL.elements = {
    // ç™»å…¥ç›¸é—œ
    authOverlay: document.getElementById("authOverlay"),
    registerID: document.getElementById("registerID"),
    devKeyInput: document.getElementById("devKeyInput"),
    registerPwd: document.getElementById("registerPwd"),
    registerPwdConfirm: document.getElementById("registerPwdConfirm"),
    registerBtn: document.getElementById("registerBtn"),
    loginID: document.getElementById("loginID"),
    loginPwd: document.getElementById("loginPwd"),
    loginBtn: document.getElementById("loginBtn"),
    // æ˜Ÿçƒé¸æ“‡ç›¸é—œ
    planetSelect: document.getElementById("planetSelect"),
    devBlackHoleCard: document.getElementById("devBlackHoleCard"),
    planetButtons: document.querySelectorAll(".planetBtn"),
    // éŠæˆ²ç•«å¸ƒç›¸é—œ
    gameCanvas: document.getElementById("game"),
    hudTop: document.getElementById("hudTop"),
    // HUDå…ƒç´ ï¼ˆèˆ‡game.js uiå°è±¡å®Œå…¨åŒ¹é…ï¼‰
    planetName: document.getElementById("planetName"),
    gameYear: document.getElementById("gameYear"),
    popCount: document.getElementById("popCount"),
    coins: document.getElementById("coins"),
    aeno: document.getElementById("aeno"),
    wood: document.getElementById("wood"),
    stone: document.getElementById("stone"),
    iron: document.getElementById("iron"),
    food: document.getElementById("food"),
    factoryCount: document.getElementById("factoryCount"),
    robotCount: document.getElementById("robotCount"),
    // æŒ‰éˆ•å…ƒç´ 
    togglePanelBtn: document.getElementById("togglePanelBtn"),
    toggleAssistantBtn: document.getElementById("toggleAssistantBtn"),
    panel: document.getElementById("panel"),
    assistantChat: document.getElementById("assistantChat"),
    btnHidePanel: document.getElementById("btnHidePanel"),
    btnSave: document.getElementById("btnSave"),
    btnBuildMode: document.getElementById("btnBuildMode"),
    btnUpgradeMode: document.getElementById("btnUpgradeMode"),
    btnAuto: document.getElementById("btnAuto"),
    btnAdSong: document.getElementById("btnAdSong"),
    btnLoopSong: document.getElementById("btnLoopSong"),
    btnRobotSend: document.getElementById("btnRobotSend"),
    btnExchange: document.getElementById("btnExchange"),
    btnTech: document.getElementById("btnTech"),
    autoState: document.getElementById("autoState"),
    loopState: document.getElementById("loopState"),
    logBox: document.getElementById("logBox"),
    // AIåŠ©æ‰‹ç›¸é—œ
    assistantChatBody: document.getElementById("assistantChatBody"),
    assistantInput: document.getElementById("assistantInput"),
    sendAssistant: document.getElementById("sendAssistant"),
    closeChat: document.getElementById("closeChat"),
    // å„ªå…ˆç´šæŒ‰éˆ•
    prioButtons: document.querySelectorAll(".prioBtn"),
  };

  console.log("é é¢å…ƒç´ ç·©å­˜å®Œæˆï¼š", window.AENO_GLOBAL.elements);

  // ==================== æ‰€æœ‰æŒ‰éˆ•äº‹ä»¶ç¶å®šï¼Œèˆ‡game.jsã€ai-assistant.jså®Œå…¨å°æ¥ ====================
  // 1. ç™»å…¥è¨»å†ŠæŒ‰éˆ•
  window.AENO_GLOBAL.elements.registerBtn.addEventListener("click", () => {
    const username = window.AENO_GLOBAL.elements.registerID.value;
    const devKey = window.AENO_GLOBAL.elements.devKeyInput.value;
    const pwd = window.AENO_GLOBAL.elements.registerPwd.value;
    const confirmPwd = window.AENO_GLOBAL.elements.registerPwdConfirm.value;
    registerAccount(username, devKey, pwd, confirmPwd);
  });

  window.AENO_GLOBAL.elements.loginBtn.addEventListener("click", () => {
    const username = window.AENO_GLOBAL.elements.loginID.value;
    const pwd = window.AENO_GLOBAL.elements.loginPwd.value;
    loginAccount(username, pwd);
  });

  // 2. ç™»å…¥é é¢æ¨™ç±¤åˆ‡æ›
  document.querySelectorAll(".authTabBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      switchAuthTab(btn.dataset.tab);
    });
  });

  // 3. æ˜ŸçƒæŒ‰éˆ•äº‹ä»¶
  window.AENO_GLOBAL.elements.planetButtons.forEach(btn => {
    btn.addEventListener("pointerdown", (e) => {
      e.preventDefault();
      const planetId = btn.dataset.planet;
      const seedType = btn.dataset.seed;
      enterPlanet(planetId, seedType);
    });
  });

  // 4. æ§åˆ¶ä¸­å¿ƒé¢æ¿æŒ‰éˆ•
  window.AENO_GLOBAL.elements.togglePanelBtn.addEventListener("click", () => {
    const panel = window.AENO_GLOBAL.elements.panel;
    panel.style.display = panel.style.display === "none" ? "flex" : "none";
  });

  window.AENO_GLOBAL.elements.btnHidePanel.addEventListener("click", () => {
    window.AENO_GLOBAL.elements.panel.style.display = "none";
  });

  // 5. AIåŠ©æ‰‹é¢æ¿æŒ‰éˆ•
  window.AENO_GLOBAL.elements.toggleAssistantBtn.addEventListener("click", () => {
    const chat = window.AENO_GLOBAL.elements.assistantChat;
    chat.style.display = chat.style.display === "none" ? "flex" : "none";
  });

  window.AENO_GLOBAL.elements.closeChat.addEventListener("click", () => {
    window.AENO_GLOBAL.elements.assistantChat.style.display = "none";
  });

  // 6. éŠæˆ²æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
  window.AENO_GLOBAL.elements.btnBuildMode.addEventListener("click", () => {
    window.mode = "build";
    document.querySelectorAll(".btnRow button").forEach(btn => btn.classList.remove("active"));
    window.AENO_GLOBAL.elements.btnBuildMode.classList.add("active");
    log("ğŸ—ï¸ å·²åˆ‡æ›åˆ°å»ºé€ æ¨¡å¼");
  });

  window.AENO_GLOBAL.elements.btnUpgradeMode.addEventListener("click", () => {
    window.mode = "upgrade";
    document.querySelectorAll(".btnRow button").forEach(btn => btn.classList.remove("active"));
    window.AENO_GLOBAL.elements.btnUpgradeMode.classList.add("active");
    log("â¬†ï¸ å·²åˆ‡æ›åˆ°å‡ç´šæ¨¡å¼");
  });

  // 7. è‡ªå‹•å»ºé€ æŒ‰éˆ•
  window.AENO_GLOBAL.elements.btnAuto.addEventListener("click", () => {
    window.autoBuild = !window.autoBuild;
    window.AENO_GLOBAL.elements.autoState.textContent = window.autoBuild ? "ON" : "OFF";
    // åŒæ­¥åˆ°game.js
    if (window.AI_SetAutoCollect) window.AI_SetAutoCollect(window.autoBuild);
    log(`ğŸ¤– è‡ªå‹•å»ºé€ å·²${window.autoBuild ? "é–‹å•Ÿ" : "é—œé–‰"}`);
  });

  // 8. å»£å‘Šæ­ŒæŒ‰éˆ•
  window.AENO_GLOBAL.elements.btnAdSong.addEventListener("click", () => {
    if (window.playAdSong) {
      fetch("./ads.json")
        .then(res => res.json())
        .then(ads => {
          const randomSong = ads.songs[Math.floor(Math.random() * ads.songs.length)];
          window.playAdSong(randomSong.url);
        })
        .catch(() => {
          log("âš ï¸ å»£å‘Šæ­Œåˆ—è¡¨åŠ è¼‰å¤±æ•—", "warning");
        });
    } else {
      log("ğŸµ å»£å‘Šæ­Œæ¨¡å¡ŠåŠ è¼‰ä¸­", "warning");
    }
  });

  window.AENO_GLOBAL.elements.btnLoopSong.addEventListener("click", () => {
    window.songLoop = !window.songLoop;
    window.AENO_GLOBAL.elements.loopState.textContent = window.songLoop ? "ON" : "OFF";
    // åŒæ­¥åˆ°game.js
    if (window.toggleSongLoop) window.toggleSongLoop();
    log(`ğŸ” å»£å‘Šæ­Œå¾ªç’°å·²${window.songLoop ? "é–‹å•Ÿ" : "é—œé–‰"}`);
  });

  // 9. æ©Ÿå™¨äººã€äº¤æ˜“æ‰€ã€ç§‘æŠ€æ¨¹æŒ‰éˆ•ï¼ˆå°æ¥game.jsï¼‰
  window.AENO_GLOBAL.elements.btnRobotSend.addEventListener("click", () => {
    if (window.sendRobot) {
      const targetId = prompt("è«‹è¼¸å…¥è¦æ´¾é£çš„æ˜ŸçƒIDï¼ˆ1-20ï¼‰ï¼š");
      if (targetId && !isNaN(targetId)) {
        window.sendRobot(parseInt(targetId));
      }
    } else {
      log("âš ï¸ æ©Ÿå™¨äººæ¨¡å¡ŠåŠ è¼‰ä¸­", "warning");
    }
  });

  window.AENO_GLOBAL.elements.btnExchange.addEventListener("click", () => {
    if (window.Game_Exchange) {
      const res = prompt("è«‹è¼¸å…¥è¦å…Œæ›çš„è³‡æºï¼ˆwood/stone/iron/foodï¼‰ï¼š");
      const amount = prompt("è«‹è¼¸å…¥å…Œæ›æ•¸é‡ï¼š");
      if (res && amount && !isNaN(amount)) {
        window.Game_Exchange(res, parseInt(amount));
      }
    } else {
      log("âš ï¸ äº¤æ˜“æ‰€æ¨¡å¡ŠåŠ è¼‰ä¸­", "warning");
    }
  });

  window.AENO_GLOBAL.elements.btnTech.addEventListener("click", () => {
    if (window.unlockTech) {
      const techList = Object.keys(window.TECH_TREE || {}).map((key, i) => `${i+1}. ${window.TECH_TREE[key].name} - ${window.TECH_TREE[key].effect}`).join("\n");
      const techKey = prompt(`è«‹è¼¸å…¥è¦è§£é–çš„ç§‘æŠ€ç·¨è™Ÿï¼š\n${techList}`);
      if (techKey && !isNaN(techKey)) {
        const keys = Object.keys(window.TECH_TREE || {});
        window.unlockTech(keys[parseInt(techKey)-1]);
      }
    } else {
      log("âš ï¸ ç§‘æŠ€æ¨¹æ¨¡å¡ŠåŠ è¼‰ä¸­", "warning");
    }
  });

  // 10. ä¿å­˜æŒ‰éˆ•
  window.AENO_GLOBAL.elements.btnSave.addEventListener("click", () => {
    if (window.saveGlobal && window.savePlanet) {
      window.saveGlobal();
      window.savePlanet();
      log("ğŸ’¾ éŠæˆ²å·²æ‰‹å‹•å­˜æª”", "ok");
    } else {
      localStorage.setItem("AENO_MANUAL_SAVE", Date.now().toString());
      log("ğŸ’¾ å·²æ‰‹å‹•ä¿å­˜éŠæˆ²é€²åº¦", "ok");
    }
  });

  // 11. AIå„ªå…ˆç´šæŒ‰éˆ•
  window.AENO_GLOBAL.elements.prioButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      const prio = btn.dataset.prio;
      window.customPriority = [prio];
      // åŒæ­¥åˆ°ai-assistant.js
      if (window.AENO_AI && window.AENO_AI.resourceManager) {
        log(`âœ… å·²è¨­ç½®AIå„ªå…ˆç´šç‚º${btn.textContent.trim()}`, "ok");
      } else {
        log(`âœ… å·²è¨­ç½®AIå„ªå…ˆç´šç‚º${btn.textContent.trim()}`, "ok");
      }
    });
  });

  // 12. AIåŠ©æ‰‹å°è©±ç™¼é€æŒ‰éˆ•
  window.AENO_GLOBAL.elements.sendAssistant.addEventListener("click", () => {
    const input = window.AENO_GLOBAL.elements.assistantInput.value;
    if (input.trim()) {
      // èª¿ç”¨ai-assistant.jsçš„è™•ç†å‡½æ•¸
      if (window.AI_Say) {
        const response = window.AI_Say(input);
        // æ·»åŠ åˆ°å°è©±æ¡†
        const playerDiv = document.createElement("div");
        playerDiv.style.marginBottom = "8px";
        playerDiv.innerHTML = `<b>ç©å®¶ï¼š</b>${input}`;
        window.AENO_GLOBAL.elements.assistantChatBody.appendChild(playerDiv);

        const aiDiv = document.createElement("div");
        aiDiv.style.marginBottom = "8px";
        aiDiv.innerHTML = `<b>AIåŠ©æ‰‹ï¼š</b>${response}`;
        window.AENO_GLOBAL.elements.assistantChatBody.appendChild(aiDiv);

        window.AENO_GLOBAL.elements.assistantChatBody.scrollTop = window.AENO_GLOBAL.elements.assistantChatBody.scrollHeight;
        window.AENO_GLOBAL.elements.assistantInput.value = "";
      } else {
        log("âš ï¸ AIåŠ©æ‰‹æ¨¡å¡ŠåŠ è¼‰ç•°å¸¸", "warning");
      }
    }
  });

  window.AENO_GLOBAL.elements.assistantInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      window.AENO_GLOBAL.elements.sendAssistant.click();
    }
  });

  // ==================== çª—å£äº‹ä»¶ ====================
  // çª—å£å¤§å°æ”¹è®Šæ™‚èª¿æ•´ç•«å¸ƒ
  window.addEventListener("resize", resizeCanvas);

  // é é¢é—œé–‰å‰è‡ªå‹•å­˜æª”
  window.addEventListener("beforeunload", () => {
    if (window.saveGlobal && window.savePlanet) {
      window.saveGlobal();
      window.savePlanet();
    }
  });

  // ==================== è‡ªå‹•æª¢æŸ¥å·²ç™»å…¥ç‹€æ…‹ ====================
  const savedAccount = localStorage.getItem(AENO_CONFIG.CURRENT_ACCOUNT_KEY);
  if (savedAccount) {
    const db = getAccountDB();
    const account = db[savedAccount];
    if (account) {
      // è‡ªå‹•ç™»å…¥
      window.AENO_GLOBAL.auth = {
        currentPlayer: savedAccount,
        isLoggedIn: true,
        isDeveloper: account.isDeveloper || false,
      };
      // éš±è—ç™»å…¥æ¡†ï¼Œé¡¯ç¤ºæ˜Ÿçƒé¸æ“‡
      window.AENO_GLOBAL.elements.authOverlay.style.display = "none";
      window.AENO_GLOBAL.elements.planetSelect.style.display = "flex";
      // è§£é–é–‹ç™¼è€…æ¬Šé™
      if (account.isDeveloper) {
        window.AENO_GLOBAL.elements.devBlackHoleCard.style.display = "block";
      }
      log("âœ… è‡ªå‹•ç™»å…¥æˆåŠŸ", "ok");
    }
  }

  console.log("AENOç³»çµ±åˆå§‹åŒ–å®Œæˆ");
});
</script>
</body>
</html>
