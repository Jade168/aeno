<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>AENO 3D ä¿®å¾©ç‰ˆ</title>
<style>
  :root { --accent: #3b82f6; --bg: #f0f9ff; }
  body { margin: 0; background: var(--bg); overflow: hidden; font-family: sans-serif; }
  
  /* é ‚éƒ¨è³‡æºæ¬„ */
  #status {
    position: absolute; top: 10px; left: 10px; right: 10px;
    display: flex; justify-content: space-between; z-index: 100;
  }
  .res { background: white; padding: 5px 10px; border-radius: 15px; font-weight: bold; font-size: 14px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

  /* éŠæˆ²ç•«å¸ƒ */
  canvas { display: block; width: 100vw; height: 100vh; touch-action: none; }

  /* æ§åˆ¶ä¸­å¿ƒ (åº•éƒ¨å¯ä¼¸ç¸®) */
  #control-panel {
    position: absolute; bottom: 0; left: 0; right: 0;
    background: white; border-top-left-radius: 20px; border-top-right-radius: 20px;
    transition: transform 0.3s; z-index: 200; padding: 15px;
    box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
  }
  .collapsed { transform: translateY(80%); } /* ç¸®å°ç‹€æ…‹ */
  
  .panel-toggle { width: 40px; height: 5px; background: #ccc; margin: 0 auto 10px; border-radius: 5px; cursor: pointer; }
  .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .btn { padding: 12px; border: none; border-radius: 10px; color: white; font-weight: bold; font-size: 14px; }
  .btn-blue { background: #3b82f6; }
  .btn-green { background: #22c55e; }
  .btn-gold { background: #f59e0b; }

  /* AI åŠ©æ‰‹ */
  #ai-bubble {
    position: absolute; top: 60px; right: 10px; left: 10px;
    background: rgba(255,255,255,0.9); border-radius: 10px; padding: 10px;
    font-size: 12px; border-left: 4px solid var(--accent); z-index: 90;
  }
</style>
</head>
<body>

<div id="status">
  <div class="res">ğŸ’° <span id="gold">500</span></div>
  <div class="res">ğŸªµ <span id="wood">150</span></div>
  <div class="res">ğŸ’ <span id="aeno">0</span></div>
</div>

<div id="ai-bubble"><b>Aenko:</b> çˆ¸çˆ¸ï¼Œ3D å¼•æ“å·²é‡æ–°å•Ÿå‹•ï¼æŒ‰ä¸‹æ–¹ã€Œæ‰‹å‹•æ¡é›†ã€æˆ–ã€Œå»ºé€ ã€ã€‚</div>

<canvas id="game"></canvas>

<div id="control-panel" id="panel">
  <div class="panel-toggle" onclick="togglePanel()"></div>
  <div style="margin-bottom:10px; font-weight:bold;">ğŸ—ï¸ å»ºè¨­èˆ‡è³‡æº</div>
  <div class="btn-grid">
    <button class="btn btn-green" onclick="collect()">â›ï¸ æ‰‹å‹•æ¡é›† (+5)</button>
    <button class="btn btn-blue" onclick="build('farm')">ğŸŒ¾ è“‹è¾²ç”° (100é‡‘)</button>
    <button class="btn btn-gold" onclick="build('mine')">âš’ï¸ è“‹ç¤¦å ´ (200é‡‘)</button>
    <button class="btn" style="background:#64748b" onclick="togglePanel()">æ”¶èµ·é¢æ¿</button>
  </div>
</div>

<script>
const cv = document.getElementById('game');
const ctx = cv.getContext('2d');
let width, height;

// éŠæˆ²ç‹€æ…‹
let state = {
  gold: 500, wood: 100,
  buildings: [],
  gridSize: 10,
  tileSize: 40
};

// éŸ¿æ‡‰å¼ç•«å¸ƒ
function resize() {
  width = cv.width = window.innerWidth;
  height = cv.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// åæ¨™è½‰æ› (Isometric 3D)
function toIso(x, y) {
  return {
    x: (x - y) * state.tileSize + width / 2,
    y: (x + y) * (state.tileSize / 2) + height / 4
  };
}

// ç¹ªè£½å¾ªç’°
function draw() {
  ctx.clearRect(0, 0, width, height);

  // 1. ç•«åœ°å¡Š
  for (let x = 0; x < state.gridSize; x++) {
    for (let y = 0; y < state.gridSize; y++) {
      const pos = toIso(x, y);
      drawDiamond(pos.x, pos.y, state.tileSize, "#b9fbc0");
      
      // 2. æª¢æŸ¥ä¸¦ç•«å»ºç¯‰
      const b = state.buildings.find(b => b.x === x && b.y === y);
      if(b) {
        drawBuilding(pos.x, pos.y, b.type);
      }
    }
  }
  requestAnimationFrame(draw);
}

function drawDiamond(x, y, size, color) {
  ctx.beginPath();
  ctx.moveTo(x, y);
  ctx.lineTo(x + size, y + size / 2);
  ctx.lineTo(x, y + size);
  ctx.lineTo(x - size, y + size / 2);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.fill();
  ctx.strokeStyle = "rgba(0,0,0,0.05)";
  ctx.stroke();
}

function drawBuilding(x, y, type) {
  ctx.fillStyle = type === 'farm' ? "#fbbf24" : "#94a3b8";
  // ç•«ä¸€å€‹ç°¡å–®çš„ç«‹æ–¹é«”æ„Ÿ
  ctx.beginPath();
  ctx.rect(x - 10, y, 20, -25);
  ctx.fill();
  ctx.strokeStyle = "white";
  ctx.stroke();
}

// åŠŸèƒ½å‡½æ•¸
function collect() {
  state.gold += 5;
  state.wood += 2;
  updateUI();
}

function build(type) {
  const cost = type === 'farm' ? 100 : 200;
  if(state.gold >= cost) {
    state.gold -= cost;
    // éš¨æ©Ÿæ‰¾å€‹ç©ºä½è“‹
    let rx = Math.floor(Math.random() * state.gridSize);
    let ry = Math.floor(Math.random() * state.gridSize);
    state.buildings.push({ x: rx, y: ry, type: type });
    updateUI();
    document.getElementById('ai-bubble').innerText = "Aenko: å»ºç¯‰æˆåŠŸï¼è³‡æºæ¯ç§’è‡ªå‹•å¢åŠ ä¸­ã€‚";
  } else {
    alert("éŒ¢ä¸å¤ å‘€ï¼Œçˆ¸çˆ¸ï¼");
  }
}

// è‡ªå‹•ç”¢è³‡æº
setInterval(() => {
  state.buildings.forEach(b => {
    if(b.type === 'farm') state.gold += 2;
    if(b.type === 'mine') state.gold += 5;
  });
  updateUI();
}, 1000);

function updateUI() {
  document.getElementById('gold').innerText = state.gold;
  document.getElementById('wood').innerText = state.wood;
}

function togglePanel() {
  document.getElementById('control-panel').classList.toggle('collapsed');
}

// å•Ÿå‹•
draw();
</script>
</body>
</html>
