<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1">
<title>AENO V3 - å‰µä¸–å‹•æ¼«ç‰ˆ</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
<style>
    html,body{margin:0;padding:0;height:100%;overflow:hidden;background:#000;font-family:sans-serif}
    #ui-layer{position:absolute;inset:0;pointer-events:none;z-index:10}
    #ui-layer > * {pointer-events: auto;}
    
    /* é ‚éƒ¨æ•¸æ“šæ¬„ - ä¸é®æ“‹ä¸­é–“ */
    .hud{position:absolute;top:0;left:0;width:100%;background:rgba(0,0,0,0.6);color:#fff;display:flex;justify-content:space-around;padding:10px 0;font-size:14px;backdrop-filter:blur(5px);border-bottom:1px solid #00f2fe}
    .hud span{color:#00f2fe;font-weight:bold}

    /* æ§åˆ¶é¢æ¿ */
    .panel{position:absolute;bottom:80px;left:50%;transform:translateX(-50%);width:90%;max-width:400px;background:#fff;border-radius:15px;display:none;flex-direction:column;box-shadow:0 -5px 20px rgba(0,0,0,0.3);overflow:hidden}
    .panel header{background:#f3f6ff;padding:12px;font-weight:bold;text-align:center;border-bottom:1px solid #ddd}
    .panel .body{padding:15px;max-height:300px;overflow-y:auto;color:#333}
    
    .btn{padding:10px;border-radius:8px;border:1px solid #4f8cff;margin:5px;background:#eef5ff;color:#4f8cff;font-weight:bold;cursor:pointer;flex:1}
    .btn:active{background:#4f8cff;color:#fff}
    .btn-main{background:#4f8cff;color:#fff;width:100%;margin:10px 0}

    /* æµ®å‹•æŒ‰éˆ• */
    .float-btn{position:absolute;right:20px;bottom:20px;width:60px;height:60px;border-radius:50%;background:#ffb703;color:#000;font-size:24px;border:none;box-shadow:0 4px 15px rgba(0,0,0,0.3);cursor:pointer}

    /* AI åŠ©æ‰‹ç‹€æ…‹æ¢ */
    #ai-status{position:absolute;top:50px;left:0;width:100%;text-align:center;color:#ffe066;font-size:12px;background:rgba(0,0,0,0.4);padding:4px 0}
</style>
</head>
<body>

<div id="ui-layer">
    <div class="hud">
        <div>ğŸªµ <span id="wood">0</span></div>
        <div>ğŸª¨ <span id="stone">0</span></div>
        <div>ğŸ’° <span id="coin">0</span></div>
        <div>ğŸ’ <span id="aeno">0</span></div>
    </div>
    
    <div id="ai-status">AI Lupus: æ­£åœ¨æƒæé ˜åœ°...</div>

    <div id="panel" class="panel">
        <header>âš™ï¸ å¸åœ‹æ§åˆ¶ä¸­å¿ƒ</header>
        <div class="body">
            <b>ğŸ  å»ºè¨­é ˜åœ° (éœ€é‡‘å¹£ 20)</b>
            <div style="display:flex">
                <button class="btn" onclick="setBuildMode('farm')">ğŸŒ¾ è¾²ç”°</button>
                <button class="btn" onclick="setBuildMode('lumber')">ğŸŒ² ä¼æœ¨å ´</button>
                <button class="btn" onclick="setBuildMode('mine')">â›ï¸ ç¤¦å ´</button>
            </div>
            <hr>
            <b>ğŸ¤– è‡ªå‹•åŒ–åŠ©æ‰‹</b>
            <button class="btn btn-main" onclick="toggleAI()" id="ai-btn">é–‹å•Ÿ AI è‡ªå‹•å»ºè¨­ (æ¶ˆè€—50%è³‡æº)</button>
            <hr>
            <button class="btn btn-main" style="background:#ff6b6b;border:none" onclick="resetGame()">âš ï¸ é‡ç½®é€²åº¦</button>
        </div>
    </div>

    <button class="float-btn" onclick="togglePanel()">ğŸ—ï¸</button>
</div>

<script>
/* ===== éŠæˆ²é‚è¼¯èˆ‡å­˜æª” ===== */
const SAVE_KEY = "AENO_V3_FINAL";
let state = JSON.parse(localStorage.getItem(SAVE_KEY)) || {
    wood: 100, stone: 100, coin: 50, aeno: 0,
    buildings: [],
    aiEnabled: false
};

function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }

/* ===== Phaser 3 å¼•æ“æ ¸å¿ƒ ===== */
const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#cfe8ff',
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let scene, buildMode = null;

function preload() {}

function create() {
    scene = this;
    
    // ç¹ªè£½å‹•æ¼«é¢¨è‰åœ°
    const bg = this.add.graphics();
    bg.fillStyle(0x7cfc00, 1);
    bg.fillRect(0, 0, 2000, 2000);
    // åŠ å…¥ä¸€äº›è£é£¾é»
    for(let i=0; i<100; i++) {
        bg.fillStyle(0x32cd32, 0.5);
        bg.fillCircle(Math.random()*2000, Math.random()*2000, 5);
    }

    // è¼‰å…¥å·²æœ‰å»ºç¯‰
    state.buildings.forEach(b => drawBuilding(b.x, b.y, b.type));

    // é»æ“Šåœ°é¢å»ºé€ 
    this.input.on('pointerdown', (pointer) => {
        if (buildMode && state.coin >= 20) {
            const b = { x: pointer.worldX, y: pointer.worldY, type: buildMode };
            state.buildings.push(b);
            state.coin -= 20;
            drawBuilding(b.x, b.y, b.type);
            buildMode = null;
            updateAIStatus("å»ºç¯‰å®Œæˆï¼");
            save();
        }
    });

    // å®šæ™‚ç”¢å‡ºè³‡æº (æ¯ 2 ç§’)
    this.time.addEvent({
        delay: 2000,
        callback: produceResources,
        loop: true
    });

    // AI è‡ªå‹•é‚è¼¯ (æ¯ 5 ç§’)
    this.time.addEvent({
        delay: 5000,
        callback: aiLogic,
        loop: true
    });
}

function update() {
    updateUI();
}

/* ===== åŠŸèƒ½å‡½æ•¸ ===== */
function drawBuilding(x, y, type) {
    const emojis = { farm: 'ğŸŒ¾', lumber: 'ğŸŒ²', mine: 'â›ï¸' };
    const container = scene.add.container(x, y);
    
    // å‹•æ¼«æé‚Šåœ“æ¡†
    const base = scene.add.circle(0, 0, 35, 0xffffff).setStrokeStyle(4, 0x000000);
    const icon = scene.add.text(0, 0, emojis[type], { fontSize: '32px' }).setOrigin(0.5);
    
    container.add([base, icon]);
    
    // æœå‡å‹•ç•« (å½ˆå‡ºæ•ˆæœ)
    container.setScale(0);
    scene.tweens.add({
        targets: container,
        scale: 1,
        duration: 500,
        ease: 'Back.easeOut'
    });
}

function produceResources() {
    state.buildings.forEach(b => {
        if(b.type === 'farm') state.coin += 2;
        if(b.type === 'lumber') state.wood += 5;
        if(b.type === 'mine') state.stone += 3;
    });
    // 50 æŠ½ 1 é‚è¼¯ (éš±è—åŸ·è¡Œ)
    updateUI();
}

function aiLogic() {
    if (!state.aiEnabled) return;
    
    // å¦‚æœè³‡æºå¤  50% ä¸”é‡‘å¹£è¶³å¤ ï¼Œè‡ªå‹•åœ¨éš¨æ©Ÿä½ç½®èµ·æ¨“
    if (state.coin >= 40) {
        const types = ['farm', 'lumber', 'mine'];
        const randomType = types[Math.floor(Math.random() * types.length)];
        const rx = 100 + Math.random() * (window.innerWidth - 200);
        const ry = 100 + Math.random() * (window.innerHeight - 200);
        
        state.coin -= 20;
        state.buildings.push({ x: rx, y: ry, type: randomType });
        drawBuilding(rx, ry, randomType);
        updateAIStatus(`AI è‡ªå‹•å»ºé€ äº† ${randomType}`);
        save();
    }
}

/* ===== UI æ§åˆ¶ ===== */
function updateUI() {
    document.getElementById('wood').innerText = Math.floor(state.wood);
    document.getElementById('stone').innerText = Math.floor(state.stone);
    document.getElementById('coin').innerText = Math.floor(state.coin);
    document.getElementById('aeno').innerText = Math.floor(state.aeno);
}

function togglePanel() {
    const p = document.getElementById('panel');
    p.style.display = p.style.display === 'flex' ? 'none' : 'flex';
}

function setBuildMode(type) {
    buildMode = type;
    togglePanel();
    updateAIStatus(`è«‹é»æ“Šåœ°åœ–ä½ç½®æ”¾ç½® ${type}`);
}

function toggleAI() {
    state.aiEnabled = !state.aiEnabled;
    document.getElementById('ai-btn').innerText = state.aiEnabled ? "AI å·²å•Ÿå‹• (é—œé–‰)" : "é–‹å•Ÿ AI è‡ªå‹•å»ºè¨­";
    updateAIStatus(state.aiEnabled ? "AI Lupus æ­£åœ¨æ¥ç®¡å»ºè¨­..." : "AI å·²åœæ©Ÿã€‚");
    save();
}

function updateAIStatus(msg) {
    document.getElementById('ai-status').innerText = "AI Lupus: " + msg;
}

function resetGame() {
    if(confirm("ç¢ºå®šé‡ç½®å—ï¼Ÿ")) {
        localStorage.clear();
        location.reload();
    }
}

function manualSave() {
    save();
    alert("é‡å­åŒæ­¥å®Œæˆï¼");
}
</script>
</body>
</html>
