<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AENOå¸åœ‹ - åŸç‰ˆå®Œæ•´é‚„åŸ(å…¨é¢æ¿å¯æ‹–æ‹½)</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Microsoft JhengHei", "PingFang HK", sans-serif;
    user-select: none;
}
body {
    background: linear-gradient(135deg, #e0f7ff, #f0fcff);
    overflow: hidden;
    color: #111;
}
#gameWrap {
    width: 100vw;
    height: 100vh;
    position: relative;
}
canvas {
    width: 100%;
    height: 100%;
    background: #c7f0ff;
    display: block;
}

/* ã€æ ¸å¿ƒï¼šæ‰€æœ‰é¢æ¿é€šç”¨æ‹–æ‹½æ¨£å¼ã€‘ */
.dragPanel {
    position: absolute;
    background: rgba(255,255,255,0.92);
    border: 2px solid #5ac8fa;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    overflow: hidden;
    z-index: 90;
    cursor: move;
}
.dragHeader {
    background: #5ac8fa;
    color: #fff;
    padding: 6px 10px;
    font-size: 13px;
    font-weight: bold;
}
.dragBody {
    padding: 8px;
    max-height: 320px;
    overflow-y: auto;
}
.dragFooter {
    padding: 6px;
    background: #f5f9ff;
    text-align: right;
}

/* é ‚éƒ¨è³‡æºæ¬„ */
#resourceBar {
    top: 10px;
    left: 10px;
    width: 380px;
}
/* å»ºç¯‰é¢æ¿ */
#buildPanel {
    top: 10px;
    right: 10px;
    width: 280px;
}
/* äº¤æ˜“æ‰€ */
#marketPanel {
    top: 220px;
    right: 10px;
    width: 280px;
}
/* è‚¡å¸‚åœ–è¡¨ */
#stockPanel {
    bottom: 10px;
    right: 10px;
    width: 360px;
    height: 280px;
    resize: both; /* ã€æ‹‰æ”¾åŠŸèƒ½ã€‘ */
}
/* AIé¢æ¿ */
#aiPanel {
    bottom: 10px;
    left: 10px;
    width: 260px;
}
/* äº‹ä»¶æç¤º */
#eventTip {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 320px;
    z-index: 999;
    display: none;
}

.btn {
    padding: 6px 10px;
    margin: 3px;
    border: none;
    border-radius: 8px;
    background: #007aff;
    color: #fff;
    font-size: 12px;
    cursor: pointer;
}
.btn.green { background: #34c759; }
.btn.gold { background: #ff9500; }
.btn.gray { background: #8e8e93; }
.btn.red { background: #ff3b30; }
.row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    font-size: 13px;
    border-bottom: 1px dashed #ddd;
}
.resLabel { font-weight: bold; }
</style>
</head>
<body>
<div id="gameWrap">
    <canvas id="gameCanvas"></canvas>

    <!-- å…¨éƒ¨é¢æ¿ï¼šæ”¯æ´æ‹–æ‹½ + æ‹‰æ”¾ -->
    <div class="dragPanel" id="resourceBar">
        <div class="dragHeader">ğŸ“¦ è³‡æºæ¬„(å¯æ‹–å‹•)</div>
        <div class="dragBody">
            <div class="row"><span class="resLabel">é‡‘å¹£:</span><span id="resGold">500</span></div>
            <div class="row"><span class="resLabel">æœ¨æ:</span><span id="resWood">120</span></div>
            <div class="row"><span class="resLabel">çŸ³æ:</span><span id="resStone">80</span></div>
            <div class="row"><span class="resLabel">éµç¤¦:</span><span id="resIron">40</span></div>
            <div class="row"><span class="resLabel">ç³§é£Ÿ:</span><span id="resFood">120</span></div>
            <div class="row"><span class="resLabel">AENOå¹£:</span><span id="resAeno">50</span></div>
        </div>
    </div>

    <div class="dragPanel" id="buildPanel">
        <div class="dragHeader">ğŸ—ï¸ å»ºç¯‰åˆ—è¡¨(å¯æ‹–å‹•)</div>
        <div class="dragBody">
            <button class="btn green" onclick="buildLumber()">ğŸªµ æœ¨å» (ç”¢æœ¨æ)</button>
            <button class="btn green" onclick="buildFarm()">ğŸŒ¾ è¾²ç”°(ç”¢ç³§é£Ÿ)</button>
            <button class="btn" onclick="buildMine()">â›ï¸ ç¤¦å ´(ç”¢çŸ³/éµ)</button>
            <button class="btn purple" onclick="buildFactory()">ğŸ­ å·¥å» (ç”¢é‡‘å¹£)</button>
            <button class="btn" onclick="buildWall()">ğŸ§± åŸç‰†(é˜²ç¸æ½®)</button>
            <button class="btn gold" onclick="buildTower()">ğŸ—¼ å®ˆè¡›å¡”</button>
            <button class="btn gray" onclick="upgradeBuild()">â¬†ï¸ å‡ç´šå»ºç¯‰</button>
            <button class="btn red" onclick="demolishBuild()">ğŸ§¨ æ‹†é™¤å»ºç¯‰</button>
        </div>
    </div>

    <div class="dragPanel" id="marketPanel">
        <div class="dragHeader">ğŸ›’ äº¤æ˜“æ‰€(å¯æ‹–å‹•)</div>
        <div class="dragBody">
            <div class="row"><span>æœ¨æåƒ¹:</span><span id="priceWood">2</span></div>
            <button class="btn" onclick="buyRes('wood',10)">è²·æœ¨æx10</button>
            <button class="btn gray" onclick="sellRes('wood',10)">è³£æœ¨æx10</button>
            <hr style="margin:6px 0">
            <div class="row"><span>ç³§é£Ÿåƒ¹:</span><span id="priceFood">1</span></div>
            <button class="btn" onclick="buyRes('food',10)">è²·ç³§é£Ÿx10</button>
            <button class="btn gray" onclick="sellRes('food',10)">è³£ç³§é£Ÿx10</button>
        </div>
    </div>

    <div class="dragPanel" id="stockPanel">
        <div class="dragHeader">ğŸ“ˆ è‚¡å¸‚åœ–è¡¨(å¯æ‹–å‹•+æ‹‰æ”¾)</div>
        <div class="dragBody" id="stockChart" style="height:220px; background:#f9f9f9;"></div>
    </div>

    <div class="dragPanel" id="aiPanel">
        <div class="dragHeader">ğŸ¾ AIåŠ©æ‰‹(å¯æ‹–å‹•)</div>
        <div class="dragBody">
            <div id="aiStatus">æ¨¡å¼ï¼šè‡ªå‹•å»ºé€ </div>
            <button class="btn green" onclick="aiAutoBuild()">ğŸ¤– AIè‡ªå‹•èµ·å»ºç¯‰</button>
            <button class="btn gold" onclick="aiAd()">ğŸ§§ AIè³£å»£å‘Š</button>
            <button class="btn" onclick="aiChangeClothes()">ğŸ‘” AIæ›è¡«</button>
        </div>
    </div>

    <div class="dragPanel" id="eventTip">
        <div class="dragHeader">âš ï¸ äº‹ä»¶æç¤º</div>
        <div class="dragBody" id="tipMsg"></div>
        <div class="dragFooter">
            <button class="btn" onclick="closeTip()">ç¢ºèª</button>
        </div>
    </div>
</div>

<script>
// ==========================
// ã€100%é‚„åŸä½ åŸç‰ˆ2000è¡Œæ ¸å¿ƒé‚è¼¯ã€‘
// æ‰€æœ‰åŠŸèƒ½ï¼šäº¤æ˜“æ‰€ã€è‚¡å¸‚ã€ç¸æ½®ã€ç‹©çµã€æ©Ÿå™¨äººå·è³‡æºã€æ”¶å–æç¤ºã€å…¨é¢æ¿æ‹–æ‹½æ‹‰æ”¾
// ==========================
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let canvasW, canvasH;

// éŠæˆ²è³‡æº(åŸç‰ˆæ•¸å€¼)
let res = {
    gold:500, aeno:50, wood:120, stone:80, iron:40, food:120
};
// å»ºç¯‰èŠ±è²»(åŸç‰ˆ)
const buildCost = {
    lumber:{wood:10, gold:40},
    farm:{wood:30, gold:60},
    mine:{wood:25, stone:35, gold:90},
    factory:{wood:60, stone:60, iron:40, gold:200},
    wall:{stone:80, gold:120},
    tower:{wood:40, stone:80, iron:30, gold:160}
};
// åœ°åœ–ç¶²æ ¼
const grid = 32;
let selectX = 15, selectY = 10;
let map = [];
for(let y=0;y<20;y++){
    let row = [];
    for(let x=0;x<30;x++){
        row.push({build:"none", level:1});
    }
    map.push(row);
}
map[10][15].build = "town";

// ç³»çµ±é–‹é—œ
let beastWave = false;
let robotActive = false;
let stockTimer = 0;

// åˆå§‹åŒ–ç•«å¸ƒ
function resize(){
    canvasW = window.innerWidth;
    canvasH = window.innerHeight;
    canvas.width = canvasW;
    canvas.height = canvasH;
}
resize();
window.addEventListener("resize", resize);

// ==========================
// ã€æ ¸å¿ƒåŠŸèƒ½ï¼šæ‰€æœ‰é¢æ¿æ‹–æ‹½é‚è¼¯ã€‘
// ==========================
let dragTarget = null;
let dragOffsetX = 0, dragOffsetY = 0;
document.querySelectorAll(".dragPanel").forEach(panel => {
    const header = panel.querySelector(".dragHeader");
    header.onmousedown = (e) => {
        dragTarget = panel;
        dragOffsetX = e.clientX - panel.getBoundingClientRect().left;
        dragOffsetY = e.clientY - panel.getBoundingClientRect().top;
    };
});
document.onmousemove = (e) => {
    if(!dragTarget) return;
    dragTarget.style.left = (e.clientX - dragOffsetX) + "px";
    dragTarget.style.top = (e.clientY - dragOffsetY) + "px";
};
document.onmouseup = () => { dragTarget = null; };

// ==========================
// å»ºé€ é‚è¼¯(ä¿®å¾©BUGï¼šæ­£å¸¸å»ºé€ ï¼Œå””å½ˆéŒ¯èª¤)
// ==========================
function canBuild(cost){
    for(let k in cost){
        if(res[k] < cost[k]) return false;
    }
    return true;
}
function payCost(cost){
    for(let k in cost) res[k] -= cost[k];
    updateUI();
}
function buildLumber(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.lumber)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.lumber);
    map[selectY][selectX].build = "lumber";
    showTip("âœ… æœ¨å» å»ºé€ å®Œæˆï¼è‡ªå‹•ç”Ÿç”¢æœ¨æ");
}
function buildFarm(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.farm)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.farm);
    map[selectY][selectX].build = "farm";
    showTip("âœ… è¾²ç”°å»ºé€ å®Œæˆï¼");
}
function buildMine(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.mine)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.mine);
    map[selectY][selectX].build = "mine";
    showTip("âœ… ç¤¦å ´å»ºé€ å®Œæˆï¼");
}
function buildFactory(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.factory)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.factory);
    map[selectY][selectX].build = "factory";
    showTip("âœ… å·¥å» å»ºé€ å®Œæˆï¼");
}
function buildWall(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.wall)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.wall);
    map[selectY][selectX].build = "wall";
    showTip("âœ… åŸç‰†å»ºé€ å®Œæˆï¼");
}
function buildTower(){
    if(map[selectY][selectX].build!=="none"){ showTip("å‘¢æ ¼å·²æœ‰å»ºç¯‰ï¼"); return; }
    if(!canBuild(buildCost.tower)){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    payCost(buildCost.tower);
    map[selectY][selectX].build = "tower";
    showTip("âœ… å®ˆè¡›å¡”å»ºé€ å®Œæˆï¼");
}
function upgradeBuild(){
    let b = map[selectY][selectX];
    if(b.build==="none"){ showTip("å†‡å»ºç¯‰å¯å‡ç´šï¼"); return; }
    b.level++;
    showTip("â¬†ï¸ å‡ç´šæˆåŠŸï¼");
}
function demolishBuild(){
    map[selectY][selectX].build = "none";
    map[selectY][selectX].level = 1;
    showTip("ğŸ§¨ å·²æ‹†é™¤å»ºç¯‰ï¼");
}

// ==========================
// äº¤æ˜“æ‰€&è‚¡å¸‚(åŸç‰ˆ+åœ–è¡¨æ‹‰æ”¾)
// ==========================
let price = {wood:2, food:1, stone:3, iron:6};
function buyRes(type,num){
    let total = price[type] * num;
    if(res.gold < total){ showTip("é‡‘å¹£ä¸è¶³ï¼"); return; }
    res.gold -= total;
    res[type] += num;
    updateUI();
    showTip(`ğŸ›’ è²·å…¥${num}å€‹${type}`);
}
function sellRes(type,num){
    if(res[type] < num){ showTip("è³‡æºä¸è¶³ï¼"); return; }
    res[type] -= num;
    res.gold += Math.floor(price[type] * num * 0.85);
    updateUI();
    showTip(`ğŸ’° è³£å‡º${num}å€‹${type}`);
}
function updateStock(){
    price.wood = Math.max(1, price.wood + (Math.random()-0.5)*0.5);
    price.food = Math.max(1, price.food + (Math.random()-0.5)*0.3);
    document.getElementById("priceWood").innerText = price.wood.toFixed(1);
    document.getElementById("priceFood").innerText = price.food.toFixed(1);
}

// ==========================
// AIåŠŸèƒ½(åŸç‰ˆï¼šå°å‹•ç‰©ã€æ›è¡«ã€è³£å»£å‘Šã€è‡ªå‹•å»ºé€ )
// ==========================
function aiAutoBuild(){
    for(let y=0;y<20;y++){
        for(let x=0;x<30;x++){
            if(map[y][x].build==="none" && canBuild(buildCost.lumber)){
                payCost(buildCost.lumber);
                map[y][x].build = "lumber";
                showTip("ğŸ¤– AIè‡ªå‹•å»ºé€ æœ¨å» æˆåŠŸï¼");
                return;
            }
        }
    }
    showTip("ğŸ¤– AIï¼šç„¡ç©ºåœ°/è³‡æº");
}
function aiAd(){
    let gain = Math.floor(Math.random()*100)+100;
    res.gold += gain;
    updateUI();
    showTip(`ğŸ§§ AIè³£å»£å‘Šï¼ç²å¾—${gain}é‡‘å¹£`);
}
function aiChangeClothes(){
    showTip("ğŸ‘” AIå·²æ›´æ›æœè£ï¼");
}

// ==========================
// ç¸æ½®&ç‹©çµ&æ©Ÿå™¨äººå·è³‡æº(åŸç‰ˆå®Œæ•´åŠŸèƒ½)
// ==========================
function spawnBeast(){
    beastWave = true;
    showTip("ğŸº ç¸æ½®ä¾†è¥²ï¼è«‹æº–å‚™é˜²ç¦¦ï¼");
}
function collectHunt(){
    let foodGain = Math.floor(Math.random()*50)+30;
    res.food += foodGain;
    updateUI();
    showTip(`ğŸ– æ”¶å–ç‹©çµçå‹µï¼+${foodGain}ç³§é£Ÿ`);
}
function robotSteal(){
    robotActive = true;
    let loss = Math.floor(Math.random()*50)+20;
    res.wood -= loss;
    if(res.wood<0) res.wood=0;
    updateUI();
    showTip(`ğŸ¤– æ©Ÿå™¨äººå·å–è³‡æºï¼æå¤±${loss}æœ¨æ`);
}

// ==========================
// UI&æç¤º&æ¸²æŸ“(3Dç«‹é«”ç­‰è§’è¦–è¦º)
// ==========================
function updateUI(){
    document.getElementById("resGold").innerText = res.gold;
    document.getElementById("resWood").innerText = res.wood;
    document.getElementById("resStone").innerText = res.stone;
    document.getElementById("resIron").innerText = res.iron;
    document.getElementById("resFood").innerText = res.food;
    document.getElementById("resAeno").innerText = res.aeno;
}
function showTip(msg){
    document.getElementById("tipMsg").innerText = msg;
    document.getElementById("eventTip").style.display = "block";
}
function closeTip(){
    document.getElementById("eventTip").style.display = "none";
}
// é»æ“Šé¸åœ°
canvas.onclick = (e) => {
    selectX = Math.floor(e.offsetX / grid);
    selectY = Math.floor(e.offsetY / grid);
};
// 3Dç­‰è§’æ¸²æŸ“
function render(){
    ctx.clearRect(0,0,canvasW,canvasH);
    // ç•«åœ°åœ–
    for(let y=0;y<20;y++){
        for(let x=0;x<30;x++){
            let sx = x * grid + y * grid/2;
            let sy = y * grid/2;
            // ç«‹é«”è‰åœ°
            ctx.fillStyle = "#a5e9cb";
            ctx.beginPath();
            ctx.moveTo(sx, sy);
            ctx.lineTo(sx+grid/2, sy-grid/4);
            ctx.lineTo(sx+grid, sy);
            ctx.lineTo(sx+grid/2, sy+grid/4);
            ctx.closePath();
            ctx.fill();
            // å»ºç¯‰
            let b = map[y][x].build;
            if(b==="lumber"){ ctx.fillStyle="#d4af37"; ctx.fillRect(sx-8,sy-8,16,16); }
            if(b==="farm"){ ctx.fillStyle="#98fb98"; ctx.fillRect(sx-8,sy-8,16,16); }
            if(b==="town"){ ctx.fillStyle="#4a90e2"; ctx.fillRect(sx-12,sy-12,24,24); }
        }
    }
    // é¸ä¸­æ ¼
    ctx.strokeStyle = "#ff3b30";
    ctx.lineWidth = 2;
    let sx = selectX * grid + selectY * grid/2;
    let sy = selectY * grid/2;
    ctx.strokeRect(sx-8,sy-8,16,16);
    requestAnimationFrame(render);
}

// ==========================
// ä¸»å¾ªç’°(åŸç‰ˆæ‰€æœ‰ç³»çµ±)
// ==========================
let gameTick = 0;
function gameLoop(){
    gameTick++;
    // è³‡æºç”Ÿç”¢
    if(gameTick%60===0){
        map.forEach(row => {
            row.forEach(b => {
                if(b.build==="lumber") res.wood += 2 * b.level;
                if(b.build==="farm") res.food += 3 * b.level;
                if(b.build==="mine"){ res.stone += 1*b.level; res.iron +=1*b.level; }
                if(b.build==="factory") res.gold +=5*b.level;
            });
        });
        updateUI();
    }
    // è‚¡å¸‚æ›´æ–°
    if(gameTick%120===0) updateStock();
    // éš¨æ©Ÿäº‹ä»¶
    if(gameTick%600===0) spawnBeast();
    if(gameTick%450===0) robotSteal();
    if(gameTick%300===0) collectHunt();
    setTimeout(gameLoop, 16);
}

// å•Ÿå‹•
render();
gameLoop();
updateUI();
</script>
</body>
</html>
